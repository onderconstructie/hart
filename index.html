<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hartmeditatie</title>
    <style>
        :root {
            --bg: #FDFCF8;
            --surface: #FFFFFF;
            --border: #EBE8E0;
            --accent: #D4A000;
            --accent-hover: #C49300;
            --accent-light: rgba(212, 160, 0, 0.08);
            --accent-medium: rgba(212, 160, 0, 0.15);
            --accent-glow: rgba(212, 160, 0, 0.25);
            --text: #1A1916;
            --text-soft: #5C5850;
            --text-muted: #9A958A;
            
            /* Mood heatmap colors - 5 levels */
            --mood-1: rgba(212, 160, 0, 0.12);
            --mood-2: rgba(212, 160, 0, 0.22);
            --mood-3: rgba(212, 160, 0, 0.35);
            --mood-4: rgba(212, 160, 0, 0.50);
            --mood-5: rgba(212, 160, 0, 0.68);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(201, 154, 0, 0.2);
        }

        button:focus,
        input:focus {
            outline: none;
        }

        button:focus-visible {
            box-shadow: 0 0 0 3px rgba(201, 154, 0, 0.3);
        }

        html {
            overflow-y: scroll;
            scrollbar-gutter: stable;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(253, 252, 248, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid rgba(0,0,0,0.04);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-mark {
            width: 36px;
            height: 36px;
            background: linear-gradient(145deg, #E8B800, #C99A00);
            border-radius: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px var(--accent-glow);
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .logo-mark:hover {
            transform: scale(1.05);
        }

        .logo-mark:active {
            transform: scale(0.95);
        }

        .logo-mark svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .logo-tooltip {
            position: absolute;
            top: calc(100% + 12px);
            left: 0;
            width: 340px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
            text-align: left;
        }

        .logo-tooltip.visible {
            opacity: 1;
            visibility: visible;
        }

        .logo-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 16px;
            border: 8px solid transparent;
            border-bottom-color: white;
            border-top: none;
        }

        .logo-tooltip h4 {
            display: none;
        }

        .logo-tooltip p {
            font-size: 0.8rem;
            line-height: 1.6;
            color: var(--text-soft);
            margin-bottom: 12px;
        }

        .logo-tooltip p strong {
            color: var(--text);
            font-weight: 600;
        }

        .logo-tooltip .section-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 16px 0 8px 0;
        }

        .logo-tooltip .section-title:first-of-type {
            margin-top: 0;
        }

        .logo-tooltip ul {
            font-size: 0.78rem;
            line-height: 1.6;
            color: var(--text-soft);
            margin-left: 16px;
            margin-bottom: 12px;
        }

        .logo-tooltip ul li {
            margin-bottom: 4px;
        }

        .logo-tooltip .source {
            font-size: 0.7rem;
            color: var(--text-muted);
            padding-top: 12px;
            border-top: 1px solid var(--border);
            margin-top: 12px;
            line-height: 1.4;
        }

        .logo-text {
            font-size: 1.05rem;
            font-weight: 700;
            background: linear-gradient(135deg, #C99A00 0%, #A67C00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .nav {
            display: flex;
            gap: 2px;
            background: rgba(0, 0, 0, 0.04);
            padding: 4px;
            border-radius: 14px;
        }

        .nav-btn {
            padding: 10px 18px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-soft);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-btn.active {
            background: white;
            color: var(--text);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .nav-btn:hover:not(.active) {
            color: var(--text);
        }

        /* Views */
        .view {
            display: none;
            flex: 1;
            flex-direction: column;
            min-height: 0;
        }

        .view.active {
            display: flex;
        }

        /* Meditation View */
        .meditation-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .meditation-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 24px 24px 32px;
        }

        /* Breathing circle */
        .breath-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.024));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 36px;
            position: relative;
            box-shadow: 
                0 0 0 1px rgba(212, 160, 0, 0.02),
                0 15px 34px rgba(212, 160, 0, 0.032);
            transform: scale(0.7);
            transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
        }

        .breath-circle.active {
            /* Animation controlled by JavaScript for sync */
        }

        @keyframes breathe {
            0% { 
                transform: scale(0.75); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.02));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.03), 0 4px 12px rgba(201, 154, 0, 0.02);
            }
            6.25% { 
                transform: scale(0.82); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.06), rgba(166, 124, 0, 0.03));
            }
            12.5% { 
                transform: scale(0.92); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.09), rgba(166, 124, 0, 0.05));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.06), 0 10px 28px rgba(201, 154, 0, 0.06);
            }
            18.75% { 
                transform: scale(1.04); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.12), rgba(166, 124, 0, 0.07));
            }
            25% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.12), 0 20px 50px rgba(201, 154, 0, 0.14);
            }
            31.25% { 
                transform: scale(1.12); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.14), rgba(166, 124, 0, 0.09));
            }
            37.5% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
            }
            43.75% { 
                transform: scale(1.12);
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.14), rgba(166, 124, 0, 0.09));
            }
            50% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
            }
            56.25% { 
                transform: scale(1.12);
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.14), rgba(166, 124, 0, 0.09));
            }
            62.5% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.12), 0 20px 50px rgba(201, 154, 0, 0.14);
            }
            68.75% { 
                transform: scale(1.08); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.13), rgba(166, 124, 0, 0.08));
            }
            75% { 
                transform: scale(1.0); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.11), rgba(166, 124, 0, 0.07));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.08), 0 14px 38px rgba(201, 154, 0, 0.10);
            }
            81.25% { 
                transform: scale(0.92); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.08), rgba(166, 124, 0, 0.05));
            }
            87.5% { 
                transform: scale(0.86); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.06), rgba(166, 124, 0, 0.04));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.05), 0 8px 24px rgba(201, 154, 0, 0.05);
            }
            93.75% { 
                transform: scale(0.80); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.05), rgba(166, 124, 0, 0.03));
            }
            100% { 
                transform: scale(0.75); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.02));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.03), 0 4px 12px rgba(201, 154, 0, 0.02);
            }
        }

        .breath-inner {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.06),
                inset 0 -1px 4px rgba(0, 0, 0, 0.02);
            position: relative;
        }

        .breath-inner svg.heart-icon {
            width: 44px;
            height: 44px;
            fill: var(--accent);
        }

        .breath-phase {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .breath-phase-text {
            font-size: 0.9rem;
            font-weight: 700;
            background: linear-gradient(145deg, #D4A000 0%, #A67C00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.12em;
        }

        .progress-ring {
            position: absolute;
            top: -8px;
            left: -8px;
            transform: rotate(-90deg);
            pointer-events: none;
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
        }

        .progress-ring .ring-bg {
            stroke: rgba(201, 154, 0, 0.1);
        }

        .progress-ring .ring-progress {
            stroke: url(#ringGradient);
            transition: stroke-dashoffset 1s linear, opacity 0.5s ease;
        }

        /* Intention display */
        .intention-display {
            min-height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 16px;
        }

        .intention-text {
            font-size: 1.3rem;
            line-height: 1.5;
            color: var(--text);
            font-weight: 500;
            opacity: 0;
            transform: translateY(8px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            white-space: nowrap;
        }

        .intention-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .intention-text .keyword {
            font-weight: 700;
            background: linear-gradient(135deg, #D4A000, #A67C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Progress dots */
        .progress-dots {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: var(--border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dot.active {
            background: var(--accent);
            width: 28px;
            box-shadow: 0 2px 12px var(--accent-glow);
        }

        .dot.done {
            background: var(--accent);
        }

        /* Recipient selector - NEW DESIGN: chips from start */
        .recipient-section {
            margin-top: 28px;
            text-align: center;
        }

        .recipient-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .recipient-chips {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .recipient-chip {
            padding: 10px 20px;
            border: 1.5px solid var(--border);
            background: white;
            border-radius: 24px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-soft);
            cursor: pointer;
            transition: all 0.2s;
        }

        .recipient-chip:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .recipient-chip.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 2px 12px var(--accent-glow);
        }

        .recipient-chip.active:hover {
            background: var(--accent-hover);
        }

        .recipient-custom {
            display: none;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            justify-content: center;
        }

        .recipient-custom.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .recipient-input {
            padding: 10px 16px;
            border: 1.5px solid var(--border);
            border-radius: 12px;
            font-size: 0.9rem;
            color: var(--text);
            background: white;
            width: 140px;
            transition: all 0.2s;
        }

        .recipient-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .recipient-confirm {
            padding: 10px 16px;
            border: none;
            background: var(--accent);
            color: white;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recipient-confirm:hover {
            background: var(--accent-hover);
        }

        /* Controls */
        .controls {
            padding: 20px 24px 36px;
            display: flex;
            justify-content: center;
        }

        .btn {
            min-width: 180px;
            padding: 16px 36px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: 0.01em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(145deg, #E8B800 0%, #C99A00 100%);
            color: white;
            box-shadow: 
                0 4px 16px var(--accent-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(145deg, rgba(255,255,255,0.1) 0%, transparent 60%);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 24px var(--accent-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.97);
        }

        .btn-secondary {
            background: white;
            color: var(--accent);
            border: 2px solid var(--border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
            position: relative;
        }

        /* Rating View */
        .rating-view {
            padding: 32px 24px;
            display: none;
            flex-direction: column;
            flex: 1;
        }

        .rating-view.active {
            display: flex;
        }

        .rating-header {
            text-align: center;
            margin-bottom: 36px;
        }

        .rating-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .rating-subtitle {
            color: var(--text-soft);
            font-size: 0.95rem;
        }

        .mood-options {
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: center;
            padding: 20px 0;
        }

        .mood-slider-container {
            padding: 0 8px;
        }

        .mood-display {
            text-align: center;
            margin-bottom: 48px;
        }

        .mood-emoji {
            width: 88px;
            height: 88px;
            margin: 0 auto 20px;
            background: linear-gradient(145deg, var(--accent-light), rgba(212, 160, 0, 0.04));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(212, 160, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mood-emoji svg {
            width: 44px;
            height: 44px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        .mood-label-main {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .mood-label-sub {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .slider-track {
            position: relative;
            padding: 24px 0;
        }

        .mood-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--border) 0%, var(--accent-light) 50%, var(--accent) 100%);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .mood-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: white;
            border: 3px solid var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
        }

        .mood-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 16px var(--accent-glow);
        }

        .mood-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: white;
            border: 3px solid var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            padding: 0 4px;
        }

        .slider-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .rating-action {
            padding-top: 24px;
            display: flex;
            justify-content: center;
        }

        /* Success */
        .success-view {
            display: none;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
        }

        .success-view.active {
            display: flex;
            animation: successIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes successIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .success-icon {
            width: 96px;
            height: 96px;
            background: linear-gradient(145deg, var(--accent-light), rgba(212, 160, 0, 0.06));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 28px;
            box-shadow: 0 12px 40px rgba(212, 160, 0, 0.15);
        }

        .success-icon svg {
            width: 44px;
            height: 44px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 2.5;
        }

        .success-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .success-text {
            color: var(--text-soft);
            margin-bottom: 40px;
            font-size: 1rem;
        }

        /* Calendar View */
        .calendar-view {
            padding: 24px;
            flex: 1;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-size: 1.15rem;
            font-weight: 700;
        }

        .calendar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-icon-small {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn-icon-small:hover {
            background: #FEF2F2;
            border-color: #FECACA;
        }

        .btn-icon-small svg {
            width: 18px;
            height: 18px;
            fill: var(--text-muted);
            transition: fill 0.2s;
        }

        .btn-icon-small:hover svg {
            fill: #EF4444;
        }

        .calendar-nav {
            display: flex;
            gap: 6px;
        }

        .calendar-nav button {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .calendar-nav button:hover {
            background: var(--bg);
            border-color: var(--accent);
        }

        .calendar-nav svg {
            width: 18px;
            height: 18px;
            fill: var(--text-soft);
        }

        .calendar {
            background: white;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 8px;
        }

        .weekday {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 8px 0;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s;
            gap: 2px;
            position: relative;
        }

        .day:hover {
            background: var(--bg);
        }

        .day.other {
            color: var(--text-muted);
        }

        .day.today {
            font-weight: 700;
            box-shadow: inset 0 0 0 2px var(--accent);
        }

        /* Heatmap colors based on mood */
        .day.has-entry {
            cursor: pointer;
        }

        .day.mood-1 { background: var(--mood-1); }
        .day.mood-2 { background: var(--mood-2); }
        .day.mood-3 { background: var(--mood-3); }
        .day.mood-4 { background: var(--mood-4); }
        .day.mood-5 { background: var(--mood-5); }

        .day.mood-1:hover { background: rgba(212, 160, 0, 0.18); }
        .day.mood-2:hover { background: rgba(212, 160, 0, 0.28); }
        .day.mood-3:hover { background: rgba(212, 160, 0, 0.42); }
        .day.mood-4:hover { background: rgba(212, 160, 0, 0.58); }
        .day.mood-5:hover { background: rgba(212, 160, 0, 0.75); }

        .day-count {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 0.6rem;
            color: var(--accent);
            font-weight: 700;
        }

        /* Stats - clickable */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .stat {
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px 12px;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .stat:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border-color: var(--accent);
        }

        .stat:active {
            transform: scale(0.98);
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1;
        }

        .stat-value svg {
            width: 28px;
            height: 28px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        .stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 700;
        }

        /* Analytics button */
        .analytics-btn {
            margin: 20px auto 0;
            padding: 14px 28px;
            background: white;
            border: 1.5px solid var(--border);
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-soft);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .analytics-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .analytics-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .analytics-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* Heatmap legend */
        .heatmap-legend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            padding: 12px;
            background: var(--bg);
            border-radius: 12px;
        }

        .legend-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .legend-scale {
            display: flex;
            gap: 3px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(26, 25, 22, 0.5);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
            z-index: 100;
        }

        .modal-backdrop.visible {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 24px;
            padding: 28px;
            width: 100%;
            max-width: 380px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalIn 0.25s ease;
            box-shadow: 0 24px 64px rgba(0,0,0,0.15);
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-date {
            font-size: 0.9rem;
            color: var(--text-soft);
        }

        .modal-close-x {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close-x:hover {
            background: var(--border);
        }

        .modal-close-x svg {
            width: 16px;
            height: 16px;
            fill: var(--text-muted);
        }

        .modal-entries {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 24px;
        }

        .modal-entry {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: var(--bg);
            border-radius: 14px;
        }

        .modal-entry-time {
            font-size: 0.9rem;
            color: var(--text-soft);
            font-weight: 500;
        }

        .modal-entry-mood {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .modal-entry-mood svg {
            width: 20px;
            height: 20px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        .modal-entry-recipient {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .modal .btn {
            width: 100%;
        }

        /* Analytics Modal specific */
        .analytics-section {
            margin-bottom: 24px;
        }

        .analytics-section:last-of-type {
            margin-bottom: 0;
        }

        .analytics-section-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 12px;
        }

        .analytics-highlight {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .highlight-card {
            background: var(--bg);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
        }

        .highlight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .highlight-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Mood distribution bar */
        .mood-distribution {
            display: flex;
            gap: 6px;
            align-items: flex-end;
            height: 60px;
            padding: 0 4px;
        }

        .mood-bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .mood-bar {
            width: 100%;
            background: var(--accent);
            border-radius: 4px 4px 0 0;
            min-height: 4px;
            transition: height 0.3s ease;
        }

        .mood-bar-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        /* Streak history */
        .streak-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .streak-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg);
            border-radius: 12px;
        }

        .streak-dates {
            font-size: 0.85rem;
            color: var(--text-soft);
        }

        .streak-days {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--accent);
        }

        .streak-item.current {
            border: 1.5px solid var(--accent);
            background: var(--accent-light);
        }

        /* Sessions list in analytics */
        .sessions-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .session-date-group {
            margin-bottom: 16px;
        }

        .session-date-header {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: var(--bg);
            border-radius: 10px;
            margin-bottom: 6px;
        }

        .session-time {
            font-size: 0.85rem;
            color: var(--text-soft);
        }

        .session-details {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .session-recipient {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: white;
            padding: 4px 10px;
            border-radius: 10px;
        }

        .session-mood {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .session-mood svg {
            width: 18px;
            height: 18px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            background: var(--accent-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--accent);
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div class="logo">
                <div class="logo-mark" id="logo-mark">
                    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    <div class="logo-tooltip" id="logo-tooltip">
                        <h4></h4>
                        <p>Deze oefening is geïnspireerd door de boeddhistische metta meditatie. Je herhaalt vriendelijke wensen om mildheid en compassie te oefenen.</p>
                        
                        <p>Onderzoek naar loving-kindness meditatie suggereert dat deze training positieve emoties kan versterken en kan bijdragen aan hulpbronnen zoals verbondenheid en veerkracht. Effecten verschillen per persoon en groeien meestal door regelmatige oefening over tijd.</p>
                        
                        <p>Dit is geen medische behandeling en geen diagnose. Zoek bij klachten hulp via je huisarts of psycholoog.</p>
                    </div>
                </div>
                <span class="logo-text">Hartmeditatie</span>
            </div>
            <nav class="nav">
                <button class="nav-btn active" data-view="meditate">Mediteer</button>
                <button class="nav-btn" data-view="calendar">Kalender</button>
            </nav>
        </header>

        <!-- Meditate View -->
        <div id="meditate-view" class="view active">
            <div class="meditation-view">
                <div class="meditation-stage">
                    <div class="breath-circle" id="breath-circle">
                        <svg class="progress-ring" width="216" height="216" viewBox="0 0 216 216">
                            <defs>
                                <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#E8B800"/>
                                    <stop offset="100%" style="stop-color:#C99A00"/>
                                </linearGradient>
                            </defs>
                            <circle class="ring-bg" cx="108" cy="108" r="104"/>
                            <circle class="ring-progress" id="ring-progress" cx="108" cy="108" r="104" 
                                stroke-dasharray="653.45" stroke-dashoffset="0"/>
                        </svg>
                        <div class="breath-inner">
                            <svg id="heart-icon" class="heart-icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                            <div class="breath-phase" id="breath-phase">
                                <span class="breath-phase-text" id="breath-phase-text">Adem in</span>
                            </div>
                        </div>
                    </div>

                    <div class="intention-display">
                        <p class="intention-text visible" id="intention-text">
                            Dat ik me <span class="keyword">veilig</span> mag voelen
                        </p>
                    </div>

                    <div class="progress-dots" id="progress-dots">
                        <div class="dot active" data-index="0"></div>
                        <div class="dot" data-index="1"></div>
                        <div class="dot" data-index="2"></div>
                        <div class="dot" data-index="3"></div>
                    </div>

                    <!-- New recipient selector - visible from start -->
                    <div class="recipient-section" id="recipient-section">
                        <div class="recipient-label">Wens voor</div>
                        <div class="recipient-chips" id="recipient-chips">
                            <button class="recipient-chip active" data-recipient="ik">Mezelf</button>
                            <button class="recipient-chip" data-recipient="other">Iemand anders</button>
                        </div>
                        <div class="recipient-custom" id="recipient-custom">
                            <input type="text" class="recipient-input" id="recipient-input" placeholder="Naam...">
                            <button class="recipient-confirm" id="recipient-confirm">OK</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" id="start-btn">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    Start
                </button>
            </div>

            <!-- Rating -->
            <div class="rating-view" id="rating-view">
                <div class="rating-header">
                    <h2 class="rating-title">Hoe voel je je?</h2>
                    <p class="rating-subtitle">Na je meditatie</p>
                </div>

                <div class="mood-options" id="mood-options">
                    <div class="mood-display">
                        <div class="mood-emoji" id="mood-emoji">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>
                        </div>
                        <div class="mood-label-main" id="mood-label-main">Goed</div>
                        <div class="mood-label-sub" id="mood-label-sub">Tevreden en aanwezig</div>
                    </div>
                    
                    <div class="mood-slider-container">
                        <div class="slider-track">
                            <input type="range" min="1" max="5" value="3" class="mood-slider" id="mood-slider">
                        </div>
                        <div class="slider-labels">
                            <span class="slider-label">Zwaar</span>
                            <span class="slider-label">Stralend</span>
                        </div>
                    </div>
                </div>

                <div class="rating-action">
                    <button class="btn btn-primary" id="save-btn">Opslaan</button>
                </div>
            </div>

            <!-- Success -->
            <div class="success-view" id="success-view">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"/></svg>
                </div>
                <h2 class="success-title">Opgeslagen</h2>
                <p class="success-text">Goed bezig. Tot de volgende keer.</p>
                <button class="btn btn-secondary" id="new-session-btn">Nieuwe sessie</button>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar-view" class="view">
            <div class="calendar-view">
                <div class="calendar-header">
                    <h2 class="calendar-title" id="calendar-title">Januari 2026</h2>
                    <div class="calendar-actions">
                        <button class="btn-icon-small" id="clear-data" title="Wis alle data">
                            <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                        </button>
                        <div class="calendar-nav">
                            <button id="prev-month">
                                <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                            </button>
                            <button id="next-month">
                                <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="calendar">
                    <div class="weekdays">
                        <div class="weekday">Ma</div>
                        <div class="weekday">Di</div>
                        <div class="weekday">Wo</div>
                        <div class="weekday">Do</div>
                        <div class="weekday">Vr</div>
                        <div class="weekday">Za</div>
                        <div class="weekday">Zo</div>
                    </div>
                    <div class="days" id="calendar-days"></div>
                </div>

                <!-- Heatmap legend -->
                <div class="heatmap-legend">
                    <span class="legend-label">Stemming:</span>
                    <div class="legend-scale">
                        <div class="legend-box" style="background: var(--mood-1);" title="Zwaar"></div>
                        <div class="legend-box" style="background: var(--mood-2);"></div>
                        <div class="legend-box" style="background: var(--mood-3);"></div>
                        <div class="legend-box" style="background: var(--mood-4);"></div>
                        <div class="legend-box" style="background: var(--mood-5);" title="Stralend"></div>
                    </div>
                    <span class="legend-label">Stralend</span>
                </div>

                <div class="stats">
                    <div class="stat" id="stat-sessions" title="Bekijk alle sessies">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Sessies</div>
                    </div>
                    <div class="stat" id="stat-streak-card" title="Bekijk streak historie">
                        <div class="stat-value" id="stat-streak">0</div>
                        <div class="stat-label">Streak</div>
                    </div>
                    <div class="stat" id="stat-mood-card" title="Bekijk stemming analyse">
                        <div class="stat-value" id="stat-mood">—</div>
                        <div class="stat-label">Gemiddeld</div>
                    </div>
                </div>

                <!-- Analytics button -->
                <button class="analytics-btn" id="analytics-btn">
                    <svg viewBox="0 0 24 24"><path d="M3 3v18h18v-2H5V3H3zm4 12h2v4H7v-4zm4-5h2v9h-2v-9zm4-3h2v12h-2V7zm4-4h2v16h-2V3z"/></svg>
                    Uitgebreide statistieken
                </button>
            </div>
        </div>
    </div>

    <!-- Day Modal -->
    <div class="modal-backdrop" id="day-modal">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title" id="modal-title">Sessies</h3>
                    <p class="modal-date" id="modal-date"></p>
                </div>
                <button class="modal-close-x" id="day-modal-close">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-entries" id="modal-entries"></div>
            <button class="btn btn-secondary" id="modal-close">Sluiten</button>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div class="modal-backdrop" id="analytics-modal">
        <div class="modal" style="max-width: 420px;">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title">Statistieken</h3>
                    <p class="modal-date" id="analytics-subtitle">Jouw voortgang</p>
                </div>
                <button class="modal-close-x" id="analytics-modal-close">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div id="analytics-content">
                <!-- Content will be dynamically inserted -->
            </div>
            
            <button class="btn btn-secondary" id="analytics-close">Sluiten</button>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        const $$ = sel => document.querySelectorAll(sel);

        const MOODS = [
            { label: 'Zwaar', desc: 'Het voelt moeilijk', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Matig', desc: 'Niet geweldig', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="8" y1="15" x2="16" y2="15"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Goed', desc: 'Tevreden en aanwezig', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Heel goed', desc: 'Warm en open', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Stralend', desc: 'Vol liefde en vreugde', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/><path d="M9 9.5c.5-.5 1-.5 1.5 0"/><path d="M13.5 9.5c.5-.5 1-.5 1.5 0"/></svg>' }
        ];

        const STATE = {
            entries: JSON.parse(localStorage.getItem('lk_entries') || '[]'),
            recipient: 'ik',
            customRecipient: '',
            currentIntention: 0,
            isMeditating: false,
            duration: 120,
            remaining: 120,
            timer: null,
            breathTimer: null,
            breathStartTime: null,
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear(),
            selectedMood: 3,
            analyticsView: 'overview' // overview, sessions, streaks
        };

        function getIntentions(recipient) {
            if (recipient === 'ik') {
                return [
                    { text: 'Dat ik me <span class="keyword">veilig</span> mag voelen' },
                    { text: 'Dat ik me <span class="keyword">gelukkig</span> mag voelen' },
                    { text: 'Dat ik me <span class="keyword">gezond</span> mag voelen' },
                    { text: 'Dat ik met <span class="keyword">gemak</span> mag leven' }
                ];
            } else {
                return [
                    { text: `Dat ${recipient} zich <span class="keyword">veilig</span> mag voelen` },
                    { text: `Dat ${recipient} zich <span class="keyword">gelukkig</span> mag voelen` },
                    { text: `Dat ${recipient} zich <span class="keyword">gezond</span> mag voelen` },
                    { text: `Dat ${recipient} met <span class="keyword">gemak</span> mag leven` }
                ];
            }
        }

        // Logo tooltip
        $('logo-mark').addEventListener('click', (e) => {
            e.stopPropagation();
            $('logo-tooltip').classList.toggle('visible');
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.logo-mark')) {
                $('logo-tooltip').classList.remove('visible');
            }
        });

        // Recipient chips
        $$('.recipient-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                const recipient = chip.dataset.recipient;
                
                $$('.recipient-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                
                if (recipient === 'other') {
                    $('recipient-custom').classList.add('visible');
                    $('recipient-input').focus();
                } else {
                    $('recipient-custom').classList.remove('visible');
                    STATE.recipient = 'ik';
                    showIntention(STATE.currentIntention);
                }
            });
        });

        $('recipient-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') confirmRecipient();
        });

        $('recipient-confirm').addEventListener('click', confirmRecipient);

        function confirmRecipient() {
            const name = $('recipient-input').value.trim();
            if (name) {
                STATE.recipient = name;
                STATE.customRecipient = name;
                showIntention(STATE.currentIntention);
            }
        }

        // Navigation
        $$('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                $$('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                $$('.view').forEach(v => v.classList.remove('active'));
                $(`${btn.dataset.view}-view`).classList.add('active');
                if (btn.dataset.view === 'calendar') {
                    renderCalendar();
                    updateStats();
                }
            });
        });

        // Meditation
        $('start-btn').addEventListener('click', toggleMeditation);

        function toggleMeditation() {
            if (STATE.isMeditating) {
                pauseMeditation();
            } else {
                startMeditation();
            }
        }

        function startMeditation() {
            STATE.isMeditating = true;
            STATE.remaining = STATE.duration;
            STATE.currentIntention = 0;

            $('start-btn').innerHTML = `
                <svg viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                Pauze
            `;
            
            $('heart-icon').style.display = 'none';
            $('breath-phase').style.display = 'flex';
            $('breath-circle').classList.add('active');
            $('recipient-section').style.opacity = '0.4';
            $('recipient-section').style.pointerEvents = 'none';
            
            // Start de bol op kleinste grootte zodat inademen meteen begint met groeien
            const circle = $('breath-circle');
            circle.style.transform = 'scale(0.7)';
            circle.style.background = 'linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.024))';
            circle.style.boxShadow = '0 0 0 1px rgba(201, 154, 0, 0.02), 0 15px 34px rgba(201, 154, 0, 0.032)';
            
            STATE.breathStartTime = Date.now();
            showIntention(0);
            updateDots();
            updateBreathPhase();
            updateProgressRing();

            STATE.breathTimer = setInterval(() => {
                updateBreathPhase();
                updateProgressRing();
            }, 50);

            STATE.timer = setInterval(() => {
                STATE.remaining--;

                const newIntention = Math.floor((STATE.duration - STATE.remaining) / 30) % 4;
                if (newIntention !== STATE.currentIntention) {
                    STATE.currentIntention = newIntention;
                    transitionIntention(newIntention);
                }

                if (STATE.remaining <= 0) {
                    completeMeditation();
                }
            }, 1000);
        }

        function pauseMeditation() {
            STATE.isMeditating = false;
            clearInterval(STATE.timer);
            clearInterval(STATE.breathTimer);
            $('start-btn').innerHTML = `
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                Hervat
            `;
            $('breath-circle').classList.remove('active');
        }

        function completeMeditation() {
            STATE.isMeditating = false;
            clearInterval(STATE.timer);
            clearInterval(STATE.breathTimer);

            $('breath-circle').classList.remove('active');
            
            document.querySelector('.meditation-view').style.display = 'none';
            document.querySelector('.controls').style.display = 'none';
            $('rating-view').classList.add('active');

            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        function resetMeditation() {
            $('heart-icon').style.display = 'block';
            $('breath-phase').style.display = 'none';
            $('ring-progress').style.strokeDashoffset = '0';
            $('ring-progress').style.opacity = '1';
            $('recipient-section').style.opacity = '1';
            $('recipient-section').style.pointerEvents = 'auto';
            
            // Reset breath circle styles
            const circle = $('breath-circle');
            circle.style.transform = '';
            circle.style.background = '';
            circle.style.boxShadow = '';
            
            STATE.currentIntention = 0;
            showIntention(0);
            updateDots();
            
            $('start-btn').innerHTML = `
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                Start
            `;

            document.querySelector('.meditation-view').style.display = 'flex';
            document.querySelector('.controls').style.display = 'flex';
            $('rating-view').classList.remove('active');
            $('success-view').classList.remove('active');
        }

        function updateBreathPhase() {
            if (!STATE.isMeditating) return;
            
            const elapsed = Date.now() - STATE.breathStartTime;
            const cycleTime = elapsed % 16000;
            const phase = cycleTime / 1000; // 0-16 seconds
            
            const circle = $('breath-circle');
            let phaseText = 'Adem in';
            let scale, bgOpacity;
            
            if (phase < 4) {
                // INADEMEN: 0-4s - groter worden met pulsering
                phaseText = 'Adem in';
                const progress = phase / 4; // 0 to 1
                const baseScale = 0.7 + (progress * 0.3); // 0.7 to 1.0
                const pulse = Math.sin(phase * Math.PI * 2) * 0.02; // kleine pulsering
                scale = baseScale + pulse;
                bgOpacity = 0.04 + (progress * 0.12);
            } else if (phase < 10) {
                // VASTHOUDEN: 4-10s - grote grootte met pulsering
                phaseText = 'Vasthouden';
                const holdPhase = phase - 4; // 0-6 seconds
                const pulse = Math.sin(holdPhase * Math.PI * 1) * 0.02; // langzame pulsering
                scale = 1.0 + pulse;
                bgOpacity = 0.16 + (pulse * 0.5);
            } else {
                // UITADEMEN: 10-16s - kleiner worden met pulsering
                phaseText = 'Adem uit';
                const progress = (phase - 10) / 6; // 0 to 1
                const baseScale = 1.0 - (progress * 0.3); // 1.0 to 0.7
                const pulse = Math.sin((phase - 10) * Math.PI * 1.5) * 0.015; // subtiele pulsering
                scale = baseScale + pulse;
                bgOpacity = 0.16 - (progress * 0.12);
            }
            
            // Apply styles
            circle.style.transform = `scale(${scale})`;
            circle.style.background = `linear-gradient(145deg, rgba(201, 154, 0, ${bgOpacity}), rgba(166, 124, 0, ${bgOpacity * 0.6}))`;
            circle.style.boxShadow = `0 0 0 1px rgba(201, 154, 0, ${bgOpacity * 0.5}), 0 ${8 + scale * 10}px ${20 + scale * 20}px rgba(201, 154, 0, ${bgOpacity * 0.8})`;
            
            $('breath-phase-text').textContent = phaseText;
        }

        function updateProgressRing() {
            if (!STATE.isMeditating) return;
            
            const circumference = 653.45;
            const elapsed = STATE.duration - STATE.remaining;
            const progress = elapsed / STATE.duration;
            
            const offset = -circumference * progress;
            $('ring-progress').style.strokeDashoffset = offset;
            
            const opacity = 1 - (progress * 0.7);
            $('ring-progress').style.opacity = opacity;
        }

        function showIntention(index) {
            const intentions = getIntentions(STATE.recipient);
            const intentionEl = $('intention-text');
            intentionEl.innerHTML = intentions[index].text;
        }

        function transitionIntention(index) {
            const intentions = getIntentions(STATE.recipient);
            const intentionEl = $('intention-text');
            intentionEl.classList.remove('visible');
            
            setTimeout(() => {
                intentionEl.innerHTML = intentions[index].text;
                intentionEl.classList.add('visible');
                updateDots();
            }, 300);
        }

        function updateDots() {
            $$('.dot').forEach((dot, i) => {
                dot.classList.remove('active', 'done');
                if (i === STATE.currentIntention) {
                    dot.classList.add('active');
                } else if (i < STATE.currentIntention) {
                    dot.classList.add('done');
                }
            });
        }

        // Mood slider
        $('mood-slider').addEventListener('input', (e) => {
            STATE.selectedMood = parseInt(e.target.value);
            updateMoodDisplay();
        });

        function updateMoodDisplay() {
            const mood = MOODS[STATE.selectedMood - 1];
            $('mood-emoji').innerHTML = mood.icon;
            $('mood-label-main').textContent = mood.label;
            $('mood-label-sub').textContent = mood.desc;
        }

        // Save
        $('save-btn').addEventListener('click', () => {
            const entry = {
                date: new Date().toISOString(),
                mood: STATE.selectedMood,
                recipient: STATE.recipient,
                timestamp: Date.now()
            };

            STATE.entries.push(entry);
            localStorage.setItem('lk_entries', JSON.stringify(STATE.entries));

            $('rating-view').classList.remove('active');
            $('success-view').classList.add('active');
        });

        $('new-session-btn').addEventListener('click', () => {
            STATE.selectedMood = 3;
            $('mood-slider').value = 3;
            updateMoodDisplay();
            resetMeditation();
        });

        // Calendar
        $('prev-month').addEventListener('click', () => changeMonth(-1));
        $('next-month').addEventListener('click', () => changeMonth(1));

        function changeMonth(delta) {
            STATE.currentMonth += delta;
            if (STATE.currentMonth > 11) {
                STATE.currentMonth = 0;
                STATE.currentYear++;
            } else if (STATE.currentMonth < 0) {
                STATE.currentMonth = 11;
                STATE.currentYear--;
            }
            renderCalendar();
        }

        function renderCalendar() {
            const date = new Date(STATE.currentYear, STATE.currentMonth);
            const title = date.toLocaleDateString('nl-NL', { month: 'long', year: 'numeric' });
            $('calendar-title').textContent = title.charAt(0).toUpperCase() + title.slice(1);

            const container = $('calendar-days');
            container.innerHTML = '';

            const firstDay = new Date(STATE.currentYear, STATE.currentMonth, 1);
            const lastDay = new Date(STATE.currentYear, STATE.currentMonth + 1, 0);
            const startingDay = (firstDay.getDay() + 6) % 7;
            const today = new Date();

            const prevLast = new Date(STATE.currentYear, STATE.currentMonth, 0).getDate();
            for (let i = startingDay - 1; i >= 0; i--) {
                container.appendChild(createDay(prevLast - i, true));
            }

            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dateStr = formatDateKey(STATE.currentYear, STATE.currentMonth, i);
                const dayEntries = getEntriesForDate(dateStr);
                const isToday = today.getDate() === i && 
                    today.getMonth() === STATE.currentMonth && 
                    today.getFullYear() === STATE.currentYear;

                const day = createDay(i, false, isToday, dayEntries);
                if (dayEntries.length > 0) {
                    day.addEventListener('click', () => showDayModal(dateStr, dayEntries));
                }
                container.appendChild(day);
            }

            const remaining = 42 - container.children.length;
            for (let i = 1; i <= remaining; i++) {
                container.appendChild(createDay(i, true));
            }
        }

        function createDay(num, isOther, isToday = false, entries = []) {
            const day = document.createElement('div');
            day.className = 'day';
            if (isOther) day.classList.add('other');
            if (isToday) day.classList.add('today');
            
            if (entries.length > 0) {
                day.classList.add('has-entry');
                const avgMood = Math.round(entries.reduce((s, e) => s + e.mood, 0) / entries.length);
                day.classList.add(`mood-${avgMood}`);
            }

            let html = `<span>${num}</span>`;
            if (entries.length > 1) {
                html += `<span class="day-count">${entries.length}</span>`;
            }
            day.innerHTML = html;
            return day;
        }

        function getMoodSvg(mood) {
            const svgs = [
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="8" y1="14" x2="16" y2="14"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/></svg>'
            ];
            return svgs[mood - 1] || svgs[2];
        }

        function formatDateKey(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function getEntriesForDate(dateStr) {
            return STATE.entries.filter(e => e.date.startsWith(dateStr));
        }

        // Day Modal
        function showDayModal(dateStr, entries) {
            const date = new Date(dateStr);
            $('modal-title').textContent = date.toLocaleDateString('nl-NL', { weekday: 'long' });
            $('modal-date').textContent = date.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long', year: 'numeric' });

            $('modal-entries').innerHTML = entries.map(e => {
                const time = new Date(e.date).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
                const recipientText = e.recipient === 'ik' ? 'Voor mezelf' : `Voor ${e.recipient}`;
                return `
                    <div class="modal-entry">
                        <div>
                            <span class="modal-entry-time">${time}</span>
                            <div class="modal-entry-recipient">${recipientText}</div>
                        </div>
                        <span class="modal-entry-mood">${getMoodSvg(e.mood)} ${MOODS[e.mood - 1].label}</span>
                    </div>
                `;
            }).join('');

            $('day-modal').classList.add('visible');
        }

        $('day-modal').addEventListener('click', e => {
            if (e.target === $('day-modal')) $('day-modal').classList.remove('visible');
        });
        $('modal-close').addEventListener('click', () => $('day-modal').classList.remove('visible'));
        $('day-modal-close').addEventListener('click', () => $('day-modal').classList.remove('visible'));

        // Clear data
        $('clear-data').addEventListener('click', () => {
            if (confirm('Weet je zeker dat je alle sessies wilt wissen? Dit kan niet ongedaan worden gemaakt.')) {
                STATE.entries = [];
                localStorage.removeItem('lk_entries');
                renderCalendar();
                updateStats();
            }
        });

        function updateStats() {
            $('stat-total').textContent = STATE.entries.length;
            $('stat-streak').textContent = calculateStreak();

            if (STATE.entries.length > 0) {
                const avg = STATE.entries.reduce((s, e) => s + e.mood, 0) / STATE.entries.length;
                $('stat-mood').innerHTML = getMoodSvg(Math.round(avg));
            } else {
                $('stat-mood').textContent = '—';
            }
        }

        function calculateStreak() {
            if (STATE.entries.length === 0) return 0;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let checkDate = new Date(today);
            let streak = 0;

            const todayStr = checkDate.toISOString().split('T')[0];
            const hasToday = STATE.entries.some(e => e.date.startsWith(todayStr));

            if (!hasToday) {
                checkDate.setDate(checkDate.getDate() - 1);
                const yesterdayStr = checkDate.toISOString().split('T')[0];
                if (!STATE.entries.some(e => e.date.startsWith(yesterdayStr))) return 0;
            }

            while (true) {
                const dateStr = checkDate.toISOString().split('T')[0];
                if (STATE.entries.some(e => e.date.startsWith(dateStr))) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }

            return streak;
        }

        // Analytics Modal
        $('analytics-btn').addEventListener('click', () => showAnalytics('overview'));
        $('stat-sessions').addEventListener('click', () => showAnalytics('sessions'));
        $('stat-streak-card').addEventListener('click', () => showAnalytics('streaks'));
        $('stat-mood-card').addEventListener('click', () => showAnalytics('mood'));

        function showAnalytics(view) {
            STATE.analyticsView = view;
            renderAnalytics();
            $('analytics-modal').classList.add('visible');
        }

        function renderAnalytics() {
            const content = $('analytics-content');
            
            if (STATE.entries.length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><svg viewBox="0 0 24 24"><path d="M3 3v18h18v-2H5V3H3zm4 12h2v4H7v-4zm4-5h2v9h-2v-9zm4-3h2v12h-2V7zm4-4h2v16h-2V3z"/></svg></div>
                        <p>Nog geen data beschikbaar.<br>Start je eerste meditatie!</p>
                    </div>
                `;
                return;
            }

            switch (STATE.analyticsView) {
                case 'sessions':
                    content.innerHTML = renderSessionsList();
                    break;
                case 'streaks':
                    content.innerHTML = renderStreaksView();
                    break;
                case 'mood':
                    content.innerHTML = renderMoodAnalysis();
                    break;
                default:
                    content.innerHTML = renderOverview();
            }
        }

        function renderOverview() {
            const streaks = calculateAllStreaks();
            const longestStreak = streaks.length > 0 ? Math.max(...streaks.map(s => s.days)) : 0;
            const moodDist = getMoodDistribution();
            const avgMood = STATE.entries.reduce((s, e) => s + e.mood, 0) / STATE.entries.length;
            
            // Find best day
            const dayMoods = {};
            STATE.entries.forEach(e => {
                const day = new Date(e.date).toLocaleDateString('nl-NL', { weekday: 'long' });
                if (!dayMoods[day]) dayMoods[day] = [];
                dayMoods[day].push(e.mood);
            });
            
            let bestDay = '-';
            let bestDayAvg = 0;
            Object.entries(dayMoods).forEach(([day, moods]) => {
                const avg = moods.reduce((a, b) => a + b, 0) / moods.length;
                if (avg > bestDayAvg) {
                    bestDayAvg = avg;
                    bestDay = day.charAt(0).toUpperCase() + day.slice(1);
                }
            });

            return `
                <div class="analytics-highlight">
                    <div class="highlight-card">
                        <div class="highlight-value">${longestStreak}</div>
                        <div class="highlight-label">Langste streak</div>
                    </div>
                    <div class="highlight-card">
                        <div class="highlight-value">${bestDay}</div>
                        <div class="highlight-label">Beste dag</div>
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-section-title">Stemming verdeling</div>
                    <div class="mood-distribution">
                        ${[1, 2, 3, 4, 5].map(m => {
                            const count = moodDist[m] || 0;
                            const maxCount = Math.max(...Object.values(moodDist), 1);
                            const height = (count / maxCount) * 50;
                            const opacities = [0.35, 0.50, 0.65, 0.80, 1.0];
                            const opacity = opacities[m - 1];
                            return `
                                <div class="mood-bar-container">
                                    <div class="mood-bar" style="height: ${height}px; background: rgba(212, 160, 0, ${opacity});"></div>
                                    <div class="mood-bar-label">${count}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.65rem; color: var(--text-muted); margin-top: 4px; padding: 0 4px;">
                        <span>Zwaar</span>
                        <span>Stralend</span>
                    </div>
                </div>

                <div style="display: flex; gap: 8px; margin-top: 16px;">
                    <button class="btn btn-secondary" style="flex: 1; min-width: auto;" onclick="showAnalytics('sessions')">Alle sessies</button>
                    <button class="btn btn-secondary" style="flex: 1; min-width: auto;" onclick="showAnalytics('streaks')">Streaks</button>
                </div>
            `;
        }

        function renderSessionsList() {
            // Group by date
            const grouped = {};
            [...STATE.entries].reverse().forEach(e => {
                const dateKey = e.date.split('T')[0];
                if (!grouped[dateKey]) grouped[dateKey] = [];
                grouped[dateKey].push(e);
            });

            let html = `
                <button class="btn btn-secondary" style="margin-bottom: 16px; padding: 10px 16px; min-width: auto;" onclick="showAnalytics('overview')">
                    ← Terug naar overzicht
                </button>
                <div class="analytics-section">
                    <div class="analytics-section-title">Alle sessies (${STATE.entries.length})</div>
                    <div class="sessions-list">
            `;

            Object.entries(grouped).forEach(([dateKey, entries]) => {
                const date = new Date(dateKey);
                const dateStr = date.toLocaleDateString('nl-NL', { weekday: 'short', day: 'numeric', month: 'short' });
                
                html += `<div class="session-date-group">`;
                html += `<div class="session-date-header">${dateStr}</div>`;
                
                entries.forEach(e => {
                    const time = new Date(e.date).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
                    const recipientText = e.recipient === 'ik' ? 'Mezelf' : e.recipient;
                    html += `
                        <div class="session-item">
                            <span class="session-time">${time}</span>
                            <div class="session-details">
                                <span class="session-recipient">${recipientText}</span>
                                <span class="session-mood">${getMoodSvg(e.mood)}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });

            html += `</div></div>`;
            return html;
        }

        function renderStreaksView() {
            const streaks = calculateAllStreaks();
            const currentStreak = calculateStreak();

            let html = `
                <button class="btn btn-secondary" style="margin-bottom: 16px; padding: 10px 16px; min-width: auto;" onclick="showAnalytics('overview')">
                    ← Terug naar overzicht
                </button>
                <div class="analytics-section">
                    <div class="analytics-section-title">Streak historie</div>
            `;

            if (streaks.length === 0) {
                html += `<div class="empty-state" style="padding: 20px;"><p>Nog geen streaks opgebouwd.</p></div>`;
            } else {
                html += `<div class="streak-list">`;
                streaks.forEach((streak, i) => {
                    const isCurrent = i === 0 && streak.days === currentStreak && currentStreak > 0;
                    html += `
                        <div class="streak-item ${isCurrent ? 'current' : ''}">
                            <span class="streak-dates">${streak.start} - ${streak.end}</span>
                            <span class="streak-days">${streak.days} ${streak.days === 1 ? 'dag' : 'dagen'}</span>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        function renderMoodAnalysis() {
            const moodDist = getMoodDistribution();
            const avgMood = STATE.entries.reduce((s, e) => s + e.mood, 0) / STATE.entries.length;
            const opacities = [0.35, 0.50, 0.65, 0.80, 1.0];
            
            // Weekly mood trend
            const lastWeek = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                const dayEntries = STATE.entries.filter(e => e.date.startsWith(dateStr));
                const avg = dayEntries.length > 0 
                    ? dayEntries.reduce((s, e) => s + e.mood, 0) / dayEntries.length 
                    : null;
                lastWeek.push({
                    day: d.toLocaleDateString('nl-NL', { weekday: 'short' }),
                    avg
                });
            }

            return `
                <button class="btn btn-secondary" style="margin-bottom: 16px; padding: 10px 16px; min-width: auto;" onclick="showAnalytics('overview')">
                    ← Terug naar overzicht
                </button>
                
                <div class="analytics-section">
                    <div class="analytics-section-title">Gemiddelde stemming</div>
                    <div class="highlight-card" style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                        <span style="font-size: 2rem;">${getMoodSvg(Math.round(avgMood))}</span>
                        <div>
                            <div class="highlight-value">${avgMood.toFixed(1)}</div>
                            <div class="highlight-label">${MOODS[Math.round(avgMood) - 1]?.label || '-'}</div>
                        </div>
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-section-title">Afgelopen 7 dagen</div>
                    <div style="display: flex; gap: 4px; align-items: flex-end; height: 80px; padding: 0 4px;">
                        ${lastWeek.map(d => {
                            if (d.avg === null) {
                                return `<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                    <div style="width: 100%; height: 4px; background: var(--border); border-radius: 2px;"></div>
                                    <span style="font-size: 0.6rem; color: var(--text-muted); margin-top: 6px;">${d.day}</span>
                                </div>`;
                            }
                            const height = (d.avg / 5) * 50;
                            const moodIndex = Math.round(d.avg) - 1;
                            const opacity = opacities[moodIndex] || 0.65;
                            return `<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; height: ${height}px; background: rgba(212, 160, 0, ${opacity}); border-radius: 4px 4px 0 0;"></div>
                                <span style="font-size: 0.6rem; color: var(--text-muted); margin-top: 6px;">${d.day}</span>
                            </div>`;
                        }).join('')}
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-section-title">Verdeling</div>
                    ${[5, 4, 3, 2, 1].map(m => {
                        const count = moodDist[m] || 0;
                        const pct = STATE.entries.length > 0 ? (count / STATE.entries.length * 100) : 0;
                        const opacity = opacities[m - 1];
                        return `
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="width: 70px; font-size: 0.75rem; color: var(--text-soft);">${MOODS[m-1].label}</span>
                                <div style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${pct}%; height: 100%; background: rgba(212, 160, 0, ${opacity}); border-radius: 4px;"></div>
                                </div>
                                <span style="width: 30px; font-size: 0.75rem; color: var(--text-muted); text-align: right;">${count}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function calculateAllStreaks() {
            if (STATE.entries.length === 0) return [];

            // Get unique dates
            const dates = [...new Set(STATE.entries.map(e => e.date.split('T')[0]))].sort().reverse();
            
            const streaks = [];
            let currentStreak = null;

            for (let i = 0; i < dates.length; i++) {
                const currentDate = new Date(dates[i]);
                
                if (!currentStreak) {
                    currentStreak = { start: dates[i], end: dates[i], days: 1 };
                } else {
                    const prevDate = new Date(currentStreak.end);
                    const diff = (prevDate - currentDate) / (1000 * 60 * 60 * 24);
                    
                    if (diff === 1) {
                        currentStreak.end = dates[i];
                        currentStreak.days++;
                    } else {
                        streaks.push(formatStreak(currentStreak));
                        currentStreak = { start: dates[i], end: dates[i], days: 1 };
                    }
                }
            }
            
            if (currentStreak) {
                streaks.push(formatStreak(currentStreak));
            }

            return streaks.sort((a, b) => b.days - a.days);
        }

        function formatStreak(streak) {
            const formatDate = (d) => new Date(d).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
            return {
                start: formatDate(streak.start),
                end: formatDate(streak.end),
                days: streak.days
            };
        }

        function getMoodDistribution() {
            const dist = {};
            STATE.entries.forEach(e => {
                dist[e.mood] = (dist[e.mood] || 0) + 1;
            });
            return dist;
        }

        // Analytics modal close
        $('analytics-modal').addEventListener('click', e => {
            if (e.target === $('analytics-modal')) $('analytics-modal').classList.remove('visible');
        });
        $('analytics-close').addEventListener('click', () => $('analytics-modal').classList.remove('visible'));
        $('analytics-modal-close').addEventListener('click', () => $('analytics-modal').classList.remove('visible'));

        // Make showAnalytics global for inline onclick
        window.showAnalytics = showAnalytics;

        // Init
        renderCalendar();
        updateStats();
    </script>
</body>
</html>
