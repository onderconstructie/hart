<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hartmeditatie</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23D4A000'><path d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/></svg>">
    <style>
        :root {
            --bg: #FDFCF8;
            --surface: #FFFFFF;
            --border: #EBE8E0;
            --accent: #D4A000;
            --accent-hover: #C49300;
            --accent-light: rgba(212, 160, 0, 0.08);
            --accent-medium: rgba(212, 160, 0, 0.15);
            --accent-glow: rgba(212, 160, 0, 0.25);
            --text: #1A1916;
            --text-soft: #5C5850;
            --text-muted: #9A958A;
            
            /* Mood heatmap colors - 5 levels */
            --mood-1: rgba(212, 160, 0, 0.12);
            --mood-2: rgba(212, 160, 0, 0.22);
            --mood-3: rgba(212, 160, 0, 0.35);
            --mood-4: rgba(212, 160, 0, 0.50);
            --mood-5: rgba(212, 160, 0, 0.68);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(201, 154, 0, 0.2);
        }

        button:focus,
        input:focus {
            outline: none;
        }

        button:focus-visible {
            box-shadow: 0 0 0 3px rgba(201, 154, 0, 0.3);
        }

        html {
            overflow-y: scroll;
            scrollbar-gutter: stable;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        /* Header Banner */
        .header-banner {
            background: linear-gradient(145deg, #E8B800 0%, #C99A00 100%);
            padding: 14px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: 
                0 4px 16px rgba(201, 154, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
        }

        .header-banner::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .logo-mark {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-mark svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.01em;
        }

        .banner-info-btn {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.2s;
        }

        .banner-info-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .banner-info-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Navigation Bar */
        .nav-bar {
            padding: 12px 20px;
            display: flex;
            justify-content: center;
            background: rgba(253, 252, 248, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0,0,0,0.04);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .nav {
            display: flex;
            gap: 4px;
            background: var(--bg-card);
            padding: 4px;
            border-radius: 12px;
        }

        .nav-btn {
            padding: 10px 24px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-soft);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-btn.active {
            background: white;
            color: var(--text);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .nav-btn:hover:not(.active) {
            color: var(--accent);
            background: var(--accent-light);
        }

        .nav-btn:active {
            transform: scale(0.97);
        }

        /* Info Tooltip */
        .info-tooltip {
            position: absolute;
            top: 100%;
            right: 16px;
            margin-top: 8px;
            width: 320px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 0;
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
            text-align: left;
            overflow: hidden;
        }

        .info-tooltip.visible {
            opacity: 1;
            visibility: visible;
        }

        .info-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            right: 20px;
            border: 8px solid transparent;
            border-bottom-color: white;
            border-top: none;
        }

        .info-header {
            background: linear-gradient(145deg, rgba(212, 160, 0, 0.08), rgba(212, 160, 0, 0.03));
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
        }

        .info-header-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-header-title svg {
            width: 18px;
            height: 18px;
            fill: var(--accent);
        }

        .info-body {
            padding: 18px 20px;
        }

        .info-section {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .info-section:last-child {
            margin-bottom: 0;
        }

        .info-section-icon {
            width: 32px;
            height: 32px;
            min-width: 32px;
            background: var(--accent-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-section-icon svg {
            width: 16px;
            height: 16px;
            fill: var(--accent);
        }

        .info-section-content {
            flex: 1;
        }

        .info-section-content p {
            font-size: 0.8rem;
            line-height: 1.55;
            color: var(--text-soft);
            margin: 0;
        }

        .info-section-content p strong {
            color: var(--text);
            font-weight: 600;
        }

        .info-disclaimer {
            background: var(--bg);
            border-radius: 12px;
            padding: 12px 14px;
            margin-top: 16px;
        }

        .info-disclaimer p {
            font-size: 0.75rem;
            line-height: 1.5;
            color: #B5B0A5;
            margin: 0;
        }

        .info-footer {
            padding: 14px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg);
        }

        .info-footer-link {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-soft);
            text-decoration: none;
            padding: 8px 14px;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .info-footer-link:hover {
            background: white;
            color: var(--accent);
        }

        .info-footer-link svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .info-footer-link.primary {
            background: white;
            border: 1px solid var(--border);
        }

        .info-footer-link.primary:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .info-footer-link.primary svg {
            fill: var(--accent);
        }

        /* Views */
        .view {
            display: none;
            flex: 1;
            flex-direction: column;
            min-height: 0;
        }

        .view.active {
            display: flex;
        }

        /* Meditation View */
        .meditation-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .meditation-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 24px 24px 32px;
        }

        /* Breathing circle */
        .breath-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.024));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 36px;
            position: relative;
            box-shadow: 
                0 0 0 1px rgba(212, 160, 0, 0.02),
                0 15px 34px rgba(212, 160, 0, 0.032);
            transform: scale(0.7);
            transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            outline: none;
        }

        .breath-circle:hover {
            box-shadow: 
                0 0 0 1px rgba(212, 160, 0, 0.08),
                0 15px 40px rgba(212, 160, 0, 0.08);
        }

        .breath-circle:focus {
            outline: none;
        }

        .breath-circle:focus-visible {
            outline: none;
        }

        .breath-circle.active {
            /* Animation controlled by JavaScript for sync */
        }

        @keyframes breathe {
            0% { 
                transform: scale(0.75); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.02));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.03), 0 4px 12px rgba(201, 154, 0, 0.02);
            }
            6.25% { 
                transform: scale(0.82); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.06), rgba(166, 124, 0, 0.03));
            }
            12.5% { 
                transform: scale(0.92); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.09), rgba(166, 124, 0, 0.05));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.06), 0 10px 28px rgba(201, 154, 0, 0.06);
            }
            18.75% { 
                transform: scale(1.04); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.12), rgba(166, 124, 0, 0.07));
            }
            25% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.12), 0 20px 50px rgba(201, 154, 0, 0.14);
            }
            31.25% { 
                transform: scale(1.12); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.14), rgba(166, 124, 0, 0.09));
            }
            37.5% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
            }
            43.75% { 
                transform: scale(1.12);
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.14), rgba(166, 124, 0, 0.09));
            }
            50% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
            }
            56.25% { 
                transform: scale(1.12);
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.14), rgba(166, 124, 0, 0.09));
            }
            62.5% { 
                transform: scale(1.15); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.16), rgba(166, 124, 0, 0.10));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.12), 0 20px 50px rgba(201, 154, 0, 0.14);
            }
            68.75% { 
                transform: scale(1.08); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.13), rgba(166, 124, 0, 0.08));
            }
            75% { 
                transform: scale(1.0); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.11), rgba(166, 124, 0, 0.07));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.08), 0 14px 38px rgba(201, 154, 0, 0.10);
            }
            81.25% { 
                transform: scale(0.92); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.08), rgba(166, 124, 0, 0.05));
            }
            87.5% { 
                transform: scale(0.86); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.06), rgba(166, 124, 0, 0.04));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.05), 0 8px 24px rgba(201, 154, 0, 0.05);
            }
            93.75% { 
                transform: scale(0.80); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.05), rgba(166, 124, 0, 0.03));
            }
            100% { 
                transform: scale(0.75); 
                background: linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.02));
                box-shadow: 0 0 0 1px rgba(201, 154, 0, 0.03), 0 4px 12px rgba(201, 154, 0, 0.02);
            }
        }

        .breath-inner {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.06),
                inset 0 -1px 4px rgba(0, 0, 0, 0.02);
            position: relative;
        }

        .breath-inner svg.heart-icon {
            width: 44px;
            height: 44px;
            fill: var(--accent);
        }

        .breath-phase {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .breath-phase-text {
            font-size: 0.9rem;
            font-weight: 700;
            background: linear-gradient(145deg, #D4A000 0%, #A67C00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.12em;
        }

        .progress-ring {
            position: absolute;
            top: -8px;
            left: -8px;
            transform: rotate(-90deg);
            pointer-events: none;
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
        }

        .progress-ring .ring-bg {
            stroke: rgba(201, 154, 0, 0.1);
        }

        .progress-ring .ring-progress {
            stroke: url(#ringGradient);
            transition: stroke-dashoffset 1s linear, opacity 0.5s ease;
        }

        /* Intention display */
        .intention-display {
            min-height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 16px;
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            touch-action: pan-y pinch-zoom;
        }

        .intention-display:active {
            cursor: grabbing;
        }

        .intention-text {
            font-size: 1.3rem;
            line-height: 1.5;
            color: var(--text);
            font-weight: 500;
            opacity: 0;
            transform: translateY(8px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            white-space: nowrap;
        }

        .intention-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .intention-text .keyword {
            font-weight: 700;
            background: linear-gradient(135deg, #D4A000, #A67C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Progress dots */
        .progress-dots {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: var(--border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .dot:hover {
            background: var(--accent-medium);
        }

        .dot.active {
            background: var(--accent);
            width: 28px;
            box-shadow: 0 2px 12px var(--accent-glow);
        }

        .dot.done {
            background: var(--accent);
        }

        /* Recipient selector - NEW DESIGN: chips from start */
        .recipient-section {
            margin-top: 28px;
            text-align: center;
        }

        .recipient-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .recipient-chips {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .recipient-chip {
            padding: 10px 20px;
            border: 1.5px solid var(--border);
            background: white;
            border-radius: 24px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-soft);
            cursor: pointer;
            transition: all 0.2s;
        }

        .recipient-chip:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .recipient-chip.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 2px 12px var(--accent-glow);
        }

        .recipient-chip.active:hover {
            background: var(--accent-hover);
        }

        .recipient-custom {
            display: none;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            justify-content: center;
        }

        .recipient-custom.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .recipient-input {
            padding: 10px 16px;
            border: 1.5px solid var(--border);
            border-radius: 12px;
            font-size: 0.9rem;
            color: var(--text);
            background: white;
            width: 140px;
            transition: all 0.2s;
        }

        .recipient-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .recipient-confirm {
            padding: 10px 16px;
            border: none;
            background: var(--accent);
            color: white;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recipient-confirm:hover {
            background: var(--accent-hover);
        }

        .recipient-name-display {
            display: none;
            margin-top: 12px;
            padding: 10px 20px;
            background: var(--accent-light);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent);
            text-align: center;
        }

        .recipient-name-display.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Controls */
        .controls {
            padding: 20px 24px 36px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn {
            min-width: 180px;
            padding: 16px 36px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: 0.01em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(145deg, #E8B800 0%, #C99A00 100%);
            color: white;
            box-shadow: 
                0 4px 16px var(--accent-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(145deg, rgba(255,255,255,0.1) 0%, transparent 60%);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 24px var(--accent-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.97);
        }

        .btn-secondary {
            background: white;
            color: var(--accent);
            border: 2px solid var(--border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .btn-icon-only {
            min-width: 52px;
            width: 52px;
            height: 52px;
            padding: 0;
            border-radius: 50%;
        }

        .btn-icon-only svg {
            fill: var(--accent);
        }

        .btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
            position: relative;
        }

        /* Rating View */
        .rating-view {
            padding: 32px 24px;
            display: none;
            flex-direction: column;
            flex: 1;
        }

        .rating-view.active {
            display: flex;
        }

        .rating-header {
            text-align: center;
            margin-bottom: 36px;
        }

        .rating-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .rating-subtitle {
            color: var(--text-soft);
            font-size: 0.95rem;
        }

        .mood-options {
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: center;
            padding: 20px 0;
        }

        .mood-slider-container {
            padding: 0 8px;
        }

        .mood-display {
            text-align: center;
            margin-bottom: 48px;
        }

        .mood-emoji {
            width: 88px;
            height: 88px;
            margin: 0 auto 20px;
            background: linear-gradient(145deg, var(--accent-light), rgba(212, 160, 0, 0.04));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(212, 160, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mood-emoji svg {
            width: 44px;
            height: 44px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        .mood-label-main {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .mood-label-sub {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .slider-track {
            position: relative;
            padding: 24px 0;
        }

        .mood-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--border) 0%, var(--accent-light) 50%, var(--accent) 100%);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .mood-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: white;
            border: 3px solid var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
        }

        .mood-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 16px var(--accent-glow);
        }

        .mood-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: white;
            border: 3px solid var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            padding: 0 4px;
        }

        .slider-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .rating-action {
            padding-top: 24px;
            display: flex;
            justify-content: center;
        }

        /* Success */
        .success-view {
            display: none;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
        }

        .success-view.active {
            display: flex;
            animation: successIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes successIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .success-icon {
            width: 96px;
            height: 96px;
            background: linear-gradient(145deg, var(--accent-light), rgba(212, 160, 0, 0.06));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 28px;
            box-shadow: 0 12px 40px rgba(212, 160, 0, 0.15);
        }

        .success-icon svg {
            width: 44px;
            height: 44px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 2.5;
        }

        .success-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .success-text {
            color: var(--text-soft);
            margin-bottom: 40px;
            font-size: 1rem;
        }

        /* Calendar View */
        .calendar-view {
            padding: 24px;
            flex: 1;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-size: 1.15rem;
            font-weight: 700;
        }

        .calendar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-icon-small {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn-icon-small:hover {
            background: #FEF2F2;
            border-color: #FECACA;
        }

        .btn-icon-small svg {
            width: 18px;
            height: 18px;
            fill: var(--text-muted);
            transition: fill 0.2s;
        }

        .btn-icon-small:hover svg {
            fill: #EF4444;
        }

        .calendar-nav {
            display: flex;
            gap: 6px;
        }

        .calendar-nav button {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .calendar-nav button:hover {
            background: var(--bg);
            border-color: var(--accent);
        }

        .calendar-nav svg {
            width: 18px;
            height: 18px;
            fill: var(--text-soft);
        }

        .calendar {
            background: white;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 8px;
        }

        .weekday {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 8px 0;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s;
            gap: 2px;
            position: relative;
        }

        .day:hover {
            background: var(--bg);
        }

        .day.other {
            color: var(--text-muted);
        }

        .day.today {
            font-weight: 700;
            box-shadow: inset 0 0 0 2px var(--accent);
        }

        /* Heatmap colors based on mood */
        .day.has-entry {
            cursor: pointer;
        }

        .day.mood-1 { background: var(--mood-1); }
        .day.mood-2 { background: var(--mood-2); }
        .day.mood-3 { background: var(--mood-3); }
        .day.mood-4 { background: var(--mood-4); }
        .day.mood-5 { background: var(--mood-5); }

        .day.mood-1:hover { background: rgba(212, 160, 0, 0.18); }
        .day.mood-2:hover { background: rgba(212, 160, 0, 0.28); }
        .day.mood-3:hover { background: rgba(212, 160, 0, 0.42); }
        .day.mood-4:hover { background: rgba(212, 160, 0, 0.58); }
        .day.mood-5:hover { background: rgba(212, 160, 0, 0.75); }

        .day-count {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6rem;
            color: var(--accent);
            font-weight: 700;
        }

        /* Stats - clickable */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .stat {
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px 12px;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .stat:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border-color: var(--accent);
        }

        .stat:active {
            transform: scale(0.98);
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1;
        }

        .stat-value svg {
            width: 28px;
            height: 28px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        .stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 700;
        }

        /* Analytics button */
        .analytics-btn {
            margin: 20px auto 0;
            padding: 14px 28px;
            background: white;
            border: 1.5px solid var(--border);
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-soft);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .analytics-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .analytics-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .analytics-btn svg {
            width: 18px;
            height: 18px;
            fill: var(--accent);
        }

        /* Heatmap legend */
        .heatmap-legend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            padding: 12px;
            background: var(--bg);
            border-radius: 12px;
        }

        .legend-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .legend-scale {
            display: flex;
            gap: 3px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(26, 25, 22, 0.5);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
            z-index: 100;
        }

        .modal-backdrop.visible {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 24px;
            padding: 28px;
            width: 100%;
            max-width: 380px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalIn 0.25s ease;
            box-shadow: 0 24px 64px rgba(0,0,0,0.15);
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-date {
            font-size: 0.9rem;
            color: var(--text-soft);
        }

        .modal-close-x {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close-x:hover {
            background: var(--border);
        }

        .modal-close-x svg {
            width: 16px;
            height: 16px;
            fill: var(--text-muted);
        }

        .modal-entries {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 24px;
        }

        .modal-entry {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: var(--bg);
            border-radius: 14px;
        }

        .modal-entry-time {
            font-size: 0.9rem;
            color: var(--text-soft);
            font-weight: 500;
        }

        .modal-entry-mood {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .modal-entry-mood svg {
            width: 20px;
            height: 20px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        .modal-entry-recipient {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .modal .btn {
            width: 100%;
        }

        /* Analytics Modal specific */
        .analytics-section {
            margin-bottom: 24px;
        }

        .analytics-section:last-of-type {
            margin-bottom: 0;
        }

        .analytics-section-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 12px;
        }

        .analytics-highlight {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .highlight-card {
            background: var(--bg);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
        }

        .highlight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .highlight-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Mood distribution bar */
        .mood-distribution {
            display: flex;
            gap: 6px;
            align-items: flex-end;
            height: 60px;
            padding: 0 4px;
        }

        .mood-bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .mood-bar {
            width: 100%;
            background: var(--accent);
            border-radius: 4px 4px 0 0;
            min-height: 4px;
            transition: height 0.3s ease;
        }

        .mood-bar-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        /* Streak history */
        .streak-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .streak-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg);
            border-radius: 12px;
        }

        .streak-dates {
            font-size: 0.85rem;
            color: var(--text-soft);
        }

        .streak-days {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--accent);
        }

        .streak-item.current {
            border: 1.5px solid var(--accent);
            background: var(--accent-light);
        }

        /* Sessions list in analytics */
        .sessions-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .session-date-group {
            margin-bottom: 16px;
        }

        .session-date-header {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: var(--bg);
            border-radius: 10px;
            margin-bottom: 6px;
        }

        .session-time {
            font-size: 0.85rem;
            color: var(--text-soft);
        }

        .session-details {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .session-recipient {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: white;
            padding: 4px 10px;
            border-radius: 10px;
        }

        .session-mood {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .session-mood svg {
            width: 18px;
            height: 18px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 1.5;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            background: var(--accent-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--accent);
        }

        /* Settings Modal */
        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .setting-group-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: var(--bg);
            border-radius: 12px;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .setting-label-main {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text);
        }

        .setting-label-sub {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .setting-input-wrap {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .setting-input {
            width: 56px;
            padding: 8px 10px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            text-align: center;
            background: white;
            transition: all 0.2s;
        }

        .setting-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .setting-input::-webkit-inner-spin-button,
        .setting-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .setting-input[type=number] {
            -moz-appearance: textfield;
        }

        .setting-unit {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .breath-preview {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 16px;
            background: linear-gradient(145deg, var(--accent-light), rgba(212, 160, 0, 0.04));
            border-radius: 14px;
            margin-top: 4px;
        }

        .breath-preview-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            flex: 1;
        }

        .breath-preview-bar {
            height: 8px;
            background: var(--accent);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .breath-preview-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .breath-total {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-soft);
            margin-top: 8px;
        }

        .breath-total strong {
            color: var(--accent);
            font-weight: 700;
        }

        .settings-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .settings-actions .btn {
            flex: 1;
            min-width: auto;
        }

        .btn-reset {
            background: white;
            color: var(--text-soft);
            border: 1.5px solid var(--border);
            padding: 12px 20px;
        }

        .btn-reset:hover {
            background: var(--bg);
            border-color: var(--text-muted);
        }

        /* Pause indicator */
        .pause-indicator {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            gap: 6px;
        }

        .pause-indicator.visible {
            display: flex;
        }

        .pause-bar {
            width: 8px;
            height: 32px;
            background: var(--accent);
            border-radius: 4px;
        }

        /* Privacy/Welcome Modal */
        .privacy-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(26, 25, 22, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
            z-index: 200;
        }

        .privacy-backdrop.visible {
            display: flex;
        }

        .privacy-modal {
            background: white;
            border-radius: 28px;
            width: 100%;
            max-width: 380px;
            overflow: hidden;
            animation: privacyIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 24px 80px rgba(0,0,0,0.25);
        }

        @keyframes privacyIn {
            from { opacity: 0; transform: scale(0.92) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .privacy-header {
            background: linear-gradient(145deg, #E8B800 0%, #C99A00 100%);
            padding: 32px 28px 28px;
            text-align: center;
            position: relative;
        }

        .privacy-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 50%);
            pointer-events: none;
        }

        .privacy-icon {
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .privacy-icon svg {
            width: 32px;
            height: 32px;
            fill: white;
        }

        .privacy-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .privacy-subtitle {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.85);
        }

        .privacy-body {
            padding: 24px 28px;
        }

        .privacy-item {
            display: flex;
            gap: 14px;
            margin-bottom: 18px;
        }

        .privacy-item:last-child {
            margin-bottom: 0;
        }

        .privacy-item-icon {
            width: 36px;
            height: 36px;
            min-width: 36px;
            background: var(--accent-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .privacy-item-icon svg {
            width: 18px;
            height: 18px;
            fill: var(--accent);
        }

        .privacy-item-icon.green {
            background: rgba(34, 197, 94, 0.1);
        }

        .privacy-item-icon.green svg {
            fill: #22C55E;
        }

        .privacy-item-content h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
        }

        .privacy-item-content p {
            font-size: 0.8rem;
            color: var(--text-soft);
            line-height: 1.45;
            margin: 0;
        }

        .privacy-footer {
            padding: 0 28px 28px;
        }

        .privacy-accept-btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(145deg, #E8B800 0%, #C99A00 100%);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 16px var(--accent-glow);
        }

        .privacy-accept-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(145deg, rgba(255,255,255,0.1) 0%, transparent 60%);
        }

        .privacy-accept-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--accent-glow);
        }

        .privacy-accept-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .privacy-note {
            text-align: center;
            margin-top: 14px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .privacy-note a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }

        .privacy-note a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header Banner -->
        <div class="header-banner">
            <div class="logo" id="logo-home">
                <div class="logo-mark">
                    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <span class="logo-text">Hartmeditatie</span>
            </div>
            <button class="banner-info-btn" id="info-btn" title="Over deze app">
                <svg viewBox="0 0 24 24" width="18" height="18"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 16v-4M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
            <div class="info-tooltip" id="info-tooltip">
                <div class="info-header">
                    <div class="info-header-title">
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        Over Hartmeditatie
                    </div>
                </div>
                <div class="info-body">
                    <div class="info-section">
                        <div class="info-section-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2C12 2 9.5 6 9.5 9.5C9.5 11.5 10.5 13 12 13C13.5 13 14.5 11.5 14.5 9.5C14.5 6 12 2 12 2Z"/>
                                <path d="M6 5C6 5 3 8.5 3 11.5C3 13.5 4.5 14.5 6 14C7.5 13.5 8.5 11.5 8.5 9.5C8.5 7 6 5 6 5Z"/>
                                <path d="M18 5C18 5 21 8.5 21 11.5C21 13.5 19.5 14.5 18 14C16.5 13.5 15.5 11.5 15.5 9.5C15.5 7 18 5 18 5Z"/>
                                <path d="M3 10C3 10 1 13 2 15.5C3 17.5 5 17 6.5 15.5C8 14 8 11.5 7 10C6 10 3 10 3 10Z"/>
                                <path d="M21 10C21 10 23 13 22 15.5C21 17.5 19 17 17.5 15.5C16 14 16 11.5 17 10C18 10 21 10 21 10Z"/>
                                <path d="M12 13C8 13 5 16 5 18.5C5 20 7 21 12 21C17 21 19 20 19 18.5C19 16 16 13 12 13Z"/>
                            </svg>
                        </div>
                        <div class="info-section-content">
                            <p>Genspireerd door de boeddhistische <strong>Metta</strong> meditatie. Je herhaalt vriendelijke wensen om mildheid en compassie te oefenen.</p>
                        </div>
                    </div>
                    <div class="info-section">
                        <div class="info-section-icon">
                            <svg viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6h-6z"/></svg>
                        </div>
                        <div class="info-section-content">
                            <p>Onderzoek naar <strong>loving-kindness meditatie</strong> suggereert dat deze training positieve emoties kan versterken en kan bijdragen aan verbondenheid en veerkracht.</p>
                        </div>
                    </div>
                    <div class="info-disclaimer">
                        <p>Dit is geen medische behandeling of diagnose. Zoek bij klachten hulp via je huisarts of psycholoog.</p>
                    </div>
                </div>
                <div class="info-footer">
                    <a href="https://bit.ly/4azfO7S" target="_blank" rel="noopener" class="info-footer-link">
                        <svg viewBox="0 0 24 24" style="fill: var(--accent);"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                        Contact
                    </a>
                    <button class="info-footer-link primary" id="open-settings">
                        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                        Instellingen
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar">
            <nav class="nav">
                <button class="nav-btn active" data-view="meditate">Mediteer</button>
                <button class="nav-btn" data-view="calendar">Kalender</button>
            </nav>
        </div>

        <!-- Meditate View -->
        <div id="meditate-view" class="view active">
            <div class="meditation-view">
                <div class="meditation-stage">
                    <div class="breath-circle" id="breath-circle" tabindex="-1">
                        <svg class="progress-ring" width="216" height="216" viewBox="0 0 216 216">
                            <defs>
                                <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#E8B800"/>
                                    <stop offset="100%" style="stop-color:#C99A00"/>
                                </linearGradient>
                            </defs>
                            <circle class="ring-bg" cx="108" cy="108" r="104"/>
                            <circle class="ring-progress" id="ring-progress" cx="108" cy="108" r="104" 
                                stroke-dasharray="653.45" stroke-dashoffset="0"/>
                        </svg>
                        <div class="breath-inner">
                            <svg id="heart-icon" class="heart-icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                            <div class="breath-phase" id="breath-phase">
                                <span class="breath-phase-text" id="breath-phase-text">Adem in</span>
                            </div>
                            <div class="pause-indicator" id="pause-indicator">
                                <div class="pause-bar"></div>
                                <div class="pause-bar"></div>
                            </div>
                        </div>
                    </div>

                    <div class="intention-display">
                        <p class="intention-text visible" id="intention-text">
                            Dat ik me <span class="keyword">veilig</span> mag voelen
                        </p>
                    </div>

                    <div class="progress-dots" id="progress-dots">
                        <div class="dot active" data-index="0"></div>
                        <div class="dot" data-index="1"></div>
                        <div class="dot" data-index="2"></div>
                        <div class="dot" data-index="3"></div>
                    </div>

                    <!-- New recipient selector - visible from start -->
                    <div class="recipient-section" id="recipient-section">
                        <div class="recipient-label">Wens voor</div>
                        <div class="recipient-chips" id="recipient-chips">
                            <button class="recipient-chip active" data-recipient="ik">Mezelf</button>
                            <button class="recipient-chip" data-recipient="other">Iemand anders</button>
                        </div>
                        <div class="recipient-custom" id="recipient-custom">
                            <input type="text" class="recipient-input" id="recipient-input" placeholder="Naam...">
                            <button class="recipient-confirm" id="recipient-confirm">OK</button>
                        </div>
                        <div class="recipient-name-display" id="recipient-name-display"></div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" id="start-btn">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    Start
                </button>
            </div>

            <!-- Rating -->
            <div class="rating-view" id="rating-view">
                <div class="rating-header">
                    <h2 class="rating-title">Hoe voel je je?</h2>
                    <p class="rating-subtitle">Na je meditatie</p>
                </div>

                <div class="mood-options" id="mood-options">
                    <div class="mood-display">
                        <div class="mood-emoji" id="mood-emoji">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>
                        </div>
                        <div class="mood-label-main" id="mood-label-main">Goed</div>
                        <div class="mood-label-sub" id="mood-label-sub">Tevreden en aanwezig</div>
                    </div>
                    
                    <div class="mood-slider-container">
                        <div class="slider-track">
                            <input type="range" min="1" max="5" value="3" class="mood-slider" id="mood-slider">
                        </div>
                        <div class="slider-labels">
                            <span class="slider-label">Zwaar</span>
                            <span class="slider-label">Stralend</span>
                        </div>
                    </div>
                </div>

                <div class="rating-action">
                    <button class="btn btn-primary" id="save-btn">Opslaan</button>
                </div>
            </div>

            <!-- Success -->
            <div class="success-view" id="success-view">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"/></svg>
                </div>
                <h2 class="success-title">Opgeslagen</h2>
                <p class="success-text">Goed bezig. Tot de volgende keer.</p>
                <button class="btn btn-secondary" id="new-session-btn">Nieuwe sessie</button>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar-view" class="view">
            <div class="calendar-view">
                <div class="calendar-header">
                    <h2 class="calendar-title" id="calendar-title">Januari 2026</h2>
                    <div class="calendar-actions">
                        <button class="btn-icon-small" id="clear-data" title="Wis alle data">
                            <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                        </button>
                        <div class="calendar-nav">
                            <button id="prev-month">
                                <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                            </button>
                            <button id="next-month">
                                <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="calendar">
                    <div class="weekdays">
                        <div class="weekday">Ma</div>
                        <div class="weekday">Di</div>
                        <div class="weekday">Wo</div>
                        <div class="weekday">Do</div>
                        <div class="weekday">Vr</div>
                        <div class="weekday">Za</div>
                        <div class="weekday">Zo</div>
                    </div>
                    <div class="days" id="calendar-days"></div>
                </div>

                <!-- Heatmap legend -->
                <div class="heatmap-legend">
                    <span class="legend-label">Stemming:</span>
                    <div class="legend-scale">
                        <div class="legend-box" style="background: var(--mood-1);" title="Zwaar"></div>
                        <div class="legend-box" style="background: var(--mood-2);"></div>
                        <div class="legend-box" style="background: var(--mood-3);"></div>
                        <div class="legend-box" style="background: var(--mood-4);"></div>
                        <div class="legend-box" style="background: var(--mood-5);" title="Stralend"></div>
                    </div>
                    <span class="legend-label">Stralend</span>
                </div>

                <div class="stats">
                    <div class="stat" id="stat-sessions" title="Bekijk alle sessies">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Sessies</div>
                    </div>
                    <div class="stat" id="stat-streak-card" title="Bekijk streak historie">
                        <div class="stat-value" id="stat-streak">0</div>
                        <div class="stat-label">Streak</div>
                    </div>
                    <div class="stat" id="stat-mood-card" title="Bekijk stemming analyse">
                        <div class="stat-value" id="stat-mood"></div>
                        <div class="stat-label">Gemiddeld</div>
                    </div>
                </div>

                <!-- Analytics button -->
                <button class="analytics-btn" id="analytics-btn">
                    <svg viewBox="0 0 24 24"><path d="M3 3v18h18v-2H5V3H3zm4 12h2v4H7v-4zm4-5h2v9h-2v-9zm4-3h2v12h-2V7zm4-4h2v16h-2V3z"/></svg>
                    Uitgebreide statistieken
                </button>
            </div>
        </div>
    </div>

    <!-- Day Modal -->
    <div class="modal-backdrop" id="day-modal">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title" id="modal-title">Sessies</h3>
                    <p class="modal-date" id="modal-date"></p>
                </div>
                <button class="modal-close-x" id="day-modal-close">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-entries" id="modal-entries"></div>
            <button class="btn btn-secondary" id="modal-close">Sluiten</button>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div class="modal-backdrop" id="analytics-modal">
        <div class="modal" style="max-width: 420px;">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title">Statistieken</h3>
                    <p class="modal-date" id="analytics-subtitle">Jouw voortgang</p>
                </div>
                <button class="modal-close-x" id="analytics-modal-close">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div id="analytics-content">
                <!-- Content will be dynamically inserted -->
            </div>
            
            <button class="btn btn-secondary" id="analytics-close" style="margin-top: 24px;">Sluiten</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-backdrop" id="settings-modal">
        <div class="modal" style="max-width: 380px;">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title">Instellingen</h3>
                    <p class="modal-date">Ademhalingsritme</p>
                </div>
                <button class="modal-close-x" id="settings-modal-close">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="settings-content">
                <div class="setting-group">
                    <div class="setting-item">
                        <div class="setting-label">
                            <span class="setting-label-main">Inademen</span>
                            <span class="setting-label-sub">Rustig lucht opnemen</span>
                        </div>
                        <div class="setting-input-wrap">
                            <input type="number" class="setting-input" id="setting-inhale" min="2" max="10" value="4">
                            <span class="setting-unit">sec</span>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">
                            <span class="setting-label-main">Vasthouden</span>
                            <span class="setting-label-sub">Even stilstaan</span>
                        </div>
                        <div class="setting-input-wrap">
                            <input type="number" class="setting-input" id="setting-hold" min="0" max="10" value="6">
                            <span class="setting-unit">sec</span>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">
                            <span class="setting-label-main">Uitademen</span>
                            <span class="setting-label-sub">Langzaam loslaten</span>
                        </div>
                        <div class="setting-input-wrap">
                            <input type="number" class="setting-input" id="setting-exhale" min="2" max="12" value="6">
                            <span class="setting-unit">sec</span>
                        </div>
                    </div>
                </div>

                <div class="breath-preview">
                    <div class="breath-preview-item">
                        <div class="breath-preview-bar" id="preview-inhale" style="width: 40px;"></div>
                        <span class="breath-preview-label">In</span>
                    </div>
                    <div class="breath-preview-item">
                        <div class="breath-preview-bar" id="preview-hold" style="width: 60px; opacity: 0.7;"></div>
                        <span class="breath-preview-label">Vast</span>
                    </div>
                    <div class="breath-preview-item">
                        <div class="breath-preview-bar" id="preview-exhale" style="width: 60px; opacity: 0.85;"></div>
                        <span class="breath-preview-label">Uit</span>
                    </div>
                </div>
                <div class="breath-total">
                    En ademcyclus: <strong id="breath-cycle-total">16</strong> seconden
                </div>

                <div class="settings-actions">
                    <button class="btn btn-reset" id="settings-reset">Standaard</button>
                    <button class="btn btn-primary" id="settings-save">Opslaan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy/Welcome Modal -->
    <div class="privacy-backdrop" id="privacy-modal">
        <div class="privacy-modal">
            <div class="privacy-header">
                <div class="privacy-icon">
                    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <h2 class="privacy-title">Welkom</h2>
                <p class="privacy-subtitle">Even voorstellen hoe dit werkt</p>
            </div>
            
            <div class="privacy-body">
                <div class="privacy-item">
                    <div class="privacy-item-icon green">
                        <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
                    </div>
                    <div class="privacy-item-content">
                        <h4>Jouw privacy voorop</h4>
                        <p>Geen cookies, geen tracking, geen account nodig. Wij verzamelen niets.</p>
                    </div>
                </div>
                
                <div class="privacy-item">
                    <div class="privacy-item-icon">
                        <svg viewBox="0 0 24 24"><path d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H7V5h10v14z"/></svg>
                    </div>
                    <div class="privacy-item-content">
                        <h4>Lokale opslag</h4>
                        <p>Je sessies en instellingen worden alleen in je eigen browser bewaard. Wis je browserdata? Dan is alles weg.</p>
                    </div>
                </div>
                
                <div class="privacy-item">
                    <div class="privacy-item-icon">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                    </div>
                    <div class="privacy-item-content">
                        <h4>Open source</h4>
                        <p>Deze app is volledig transparant en vrij beschikbaar op GitHub.</p>
                    </div>
                </div>
            </div>
            
            <div class="privacy-footer">
                <button class="privacy-accept-btn" id="privacy-accept">
                    Begrepen, aan de slag
                </button>
                <p class="privacy-note">
                    Door verder te gaan ga je akkoord met lokale opslag
                </p>
            </div>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        const $$ = sel => document.querySelectorAll(sel);

        const MOODS = [
            { label: 'Zwaar', desc: 'Het voelt moeilijk', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Matig', desc: 'Niet geweldig', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="8" y1="15" x2="16" y2="15"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Goed', desc: 'Tevreden en aanwezig', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Heel goed', desc: 'Warm en open', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/><circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"/></svg>' },
            { label: 'Stralend', desc: 'Vol liefde en vreugde', icon: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/><path d="M9 9.5c.5-.5 1-.5 1.5 0"/><path d="M13.5 9.5c.5-.5 1-.5 1.5 0"/></svg>' }
        ];

        const DEFAULT_BREATH = { inhale: 4, hold: 6, exhale: 6 };
        const savedBreath = JSON.parse(localStorage.getItem('lk_breath') || 'null') || DEFAULT_BREATH;

        const STATE = {
            entries: JSON.parse(localStorage.getItem('lk_entries') || '[]'),
            recipient: 'ik',
            customRecipient: '',
            currentIntention: 0,
            startIntention: 0,
            isMeditating: false,
            isPaused: false,
            elapsedBeforePause: 0,
            duration: 120,
            remaining: 120,
            timer: null,
            breathTimer: null,
            breathStartTime: null,
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear(),
            selectedMood: 3,
            analyticsView: 'overview',
            breath: { ...savedBreath }
        };

        function getIntentions(recipient) {
            if (recipient === 'ik') {
                return [
                    { text: 'Dat ik me <span class="keyword">veilig</span> mag voelen' },
                    { text: 'Dat ik me <span class="keyword">gelukkig</span> mag voelen' },
                    { text: 'Dat ik me <span class="keyword">gezond</span> mag voelen' },
                    { text: 'Dat ik met <span class="keyword">gemak</span> mag leven' }
                ];
            } else {
                return [
                    { text: `Dat ${recipient} zich <span class="keyword">veilig</span> mag voelen` },
                    { text: `Dat ${recipient} zich <span class="keyword">gelukkig</span> mag voelen` },
                    { text: `Dat ${recipient} zich <span class="keyword">gezond</span> mag voelen` },
                    { text: `Dat ${recipient} met <span class="keyword">gemak</span> mag leven` }
                ];
            }
        }

        // Logo tooltip
        // Logo click - ga naar home
        $('logo-home').addEventListener('click', () => {
            $$('.nav-btn').forEach(b => b.classList.remove('active'));
            $$('.nav-btn')[0].classList.add('active');
            $$('.view').forEach(v => v.classList.remove('active'));
            $('meditate-view').classList.add('active');
        });

        // Info button - toggle tooltip
        $('info-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            $('info-tooltip').classList.toggle('visible');
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.banner-info-btn') && !e.target.closest('.info-tooltip')) {
                $('info-tooltip').classList.remove('visible');
            }
        });

        // Recipient chips
        $$('.recipient-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                const recipient = chip.dataset.recipient;
                
                $$('.recipient-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                
                if (recipient === 'other') {
                    $('recipient-name-display').classList.remove('visible');
                    $('recipient-custom').classList.add('visible');
                    $('recipient-input').focus();
                } else {
                    $('recipient-custom').classList.remove('visible');
                    $('recipient-name-display').classList.remove('visible');
                    STATE.recipient = 'ik';
                    STATE.customRecipient = '';
                    showIntention(STATE.currentIntention);
                }
            });
        });

        $('recipient-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') confirmRecipient();
        });

        $('recipient-confirm').addEventListener('click', confirmRecipient);

        function confirmRecipient() {
            const name = $('recipient-input').value.trim();
            if (name) {
                STATE.recipient = name;
                STATE.customRecipient = name;
                $('recipient-custom').classList.remove('visible');
                $('recipient-name-display').textContent = name;
                $('recipient-name-display').classList.add('visible');
                showIntention(STATE.currentIntention);
            }
        }

        // Navigation
        $$('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                $$('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                $$('.view').forEach(v => v.classList.remove('active'));
                $(`${btn.dataset.view}-view`).classList.add('active');
                if (btn.dataset.view === 'calendar') {
                    renderCalendar();
                    updateStats();
                }
            });
        });

        // Meditation
        $('start-btn').addEventListener('click', toggleMeditation);
        $('breath-circle').addEventListener('click', toggleCircle);

        function toggleCircle() {
            // Bol = start / pauze / hervat
            if (STATE.isMeditating) {
                pauseMeditation();
            } else if (STATE.isPaused) {
                resumeMeditation();
            } else {
                startMeditation();
            }
        }

        function toggleMeditation() {
            // Knop = start of skip
            if (STATE.isMeditating || STATE.isPaused) {
                skipMeditation();
            } else {
                startMeditation();
            }
        }

        function startMeditation() {
            STATE.isMeditating = true;
            STATE.isPaused = false;
            STATE.remaining = STATE.duration;
            // Onthoud waar we starten voor de timing
            STATE.startIntention = STATE.currentIntention;
            STATE.elapsedBeforePause = 0;

            $('start-btn').innerHTML = `
                <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
                Skip
            `;
            
            $('heart-icon').style.display = 'none';
            $('breath-phase').style.display = 'flex';
            $('pause-indicator').classList.remove('visible');
            $('breath-circle').classList.add('active');
            $('recipient-section').style.opacity = '0.4';
            $('recipient-section').style.pointerEvents = 'none';
            
            // Start de bol op kleinste grootte zodat inademen meteen begint met groeien
            const circle = $('breath-circle');
            circle.style.transform = 'scale(0.7)';
            circle.style.background = 'linear-gradient(145deg, rgba(201, 154, 0, 0.04), rgba(166, 124, 0, 0.024))';
            circle.style.boxShadow = '0 0 0 1px rgba(201, 154, 0, 0.02), 0 15px 34px rgba(201, 154, 0, 0.032)';
            
            STATE.breathStartTime = Date.now();
            showIntention(STATE.currentIntention);
            updateDots();
            updateBreathPhase();
            updateProgressRing();

            STATE.breathTimer = setInterval(() => {
                updateBreathPhase();
                updateProgressRing();
            }, 50);

            STATE.timer = setInterval(() => {
                STATE.remaining--;

                // Bereken intentie relatief aan startpositie
                const intentionOffset = Math.floor((STATE.duration - STATE.remaining) / 30);
                const newIntention = (STATE.startIntention + intentionOffset) % 4;
                if (newIntention !== STATE.currentIntention) {
                    STATE.currentIntention = newIntention;
                    transitionIntention(newIntention);
                }

                if (STATE.remaining <= 0) {
                    completeMeditation();
                }
            }, 1000);
        }

        function pauseMeditation() {
            STATE.isMeditating = false;
            STATE.isPaused = true;
            STATE.pausedAt = Date.now();
            STATE.elapsedBeforePause = (STATE.elapsedBeforePause || 0) + (STATE.pausedAt - STATE.breathStartTime);
            
            clearInterval(STATE.timer);
            clearInterval(STATE.breathTimer);
            
            // Toon pauze indicator
            $('breath-phase').style.display = 'none';
            $('pause-indicator').classList.add('visible');
            
            // Bol stopt met animeren maar behoudt huidige staat
            $('breath-circle').classList.remove('active');
        }

        function resumeMeditation() {
            STATE.isMeditating = true;
            STATE.isPaused = false;
            
            // Verberg pauze indicator, toon ademfase
            $('pause-indicator').classList.remove('visible');
            $('breath-phase').style.display = 'flex';
            
            // Herbereken breathStartTime zodat ademhaling verder gaat waar het was
            STATE.breathStartTime = Date.now() - STATE.elapsedBeforePause;
            
            $('breath-circle').classList.add('active');
            
            STATE.breathTimer = setInterval(() => {
                updateBreathPhase();
                updateProgressRing();
            }, 50);

            STATE.timer = setInterval(() => {
                STATE.remaining--;

                // Bereken intentie relatief aan startpositie
                const intentionOffset = Math.floor((STATE.duration - STATE.remaining) / 30);
                const newIntention = (STATE.startIntention + intentionOffset) % 4;
                if (newIntention !== STATE.currentIntention) {
                    STATE.currentIntention = newIntention;
                    transitionIntention(newIntention);
                }

                if (STATE.remaining <= 0) {
                    completeMeditation();
                }
            }, 1000);
        }

        function skipMeditation() {
            // Stop huidige sessie zonder opslaan
            STATE.isMeditating = false;
            STATE.isPaused = false;
            STATE.elapsedBeforePause = 0;
            clearInterval(STATE.timer);
            clearInterval(STATE.breathTimer);
            
            // Reset alles naar beginstaat
            $('heart-icon').style.display = 'block';
            $('breath-phase').style.display = 'none';
            $('pause-indicator').classList.remove('visible');
            $('ring-progress').style.strokeDashoffset = '0';
            $('ring-progress').style.opacity = '1';
            $('recipient-section').style.opacity = '1';
            $('recipient-section').style.pointerEvents = 'auto';
            $('breath-circle').classList.remove('active');
            
            // Reset breath circle styles
            const circle = $('breath-circle');
            circle.style.transform = '';
            circle.style.background = '';
            circle.style.boxShadow = '';
            
            // Reset recipient keuze
            $$('.recipient-chip').forEach(c => c.classList.remove('active'));
            $$('.recipient-chip')[0].classList.add('active');
            STATE.recipient = 'ik';
            STATE.customRecipient = '';
            $('recipient-custom').classList.remove('visible');
            $('recipient-input').value = '';
            $('recipient-name-display').classList.remove('visible');
            
            STATE.currentIntention = 0;
            STATE.startIntention = 0;
            STATE.remaining = STATE.duration;
            showIntention(0);
            updateDots();
            
            $('start-btn').innerHTML = `
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                Start
            `;

            document.querySelector('.meditation-view').style.display = 'flex';
            document.querySelector('.controls').style.display = 'flex';
            $('rating-view').classList.remove('active');
            $('success-view').classList.remove('active');
        }

        function completeMeditation() {
            STATE.isMeditating = false;
            STATE.isPaused = false;
            STATE.elapsedBeforePause = 0;
            clearInterval(STATE.timer);
            clearInterval(STATE.breathTimer);

            $('breath-circle').classList.remove('active');
            $('pause-indicator').classList.remove('visible');
            
            document.querySelector('.meditation-view').style.display = 'none';
            document.querySelector('.controls').style.display = 'none';
            $('rating-view').classList.add('active');

            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        function resetMeditation() {
            // Stop timers als ze lopen
            STATE.isMeditating = false;
            STATE.isPaused = false;
            STATE.elapsedBeforePause = 0;
            clearInterval(STATE.timer);
            clearInterval(STATE.breathTimer);
            
            $('heart-icon').style.display = 'block';
            $('breath-phase').style.display = 'none';
            $('pause-indicator').classList.remove('visible');
            $('ring-progress').style.strokeDashoffset = '0';
            $('ring-progress').style.opacity = '1';
            $('recipient-section').style.opacity = '1';
            $('recipient-section').style.pointerEvents = 'auto';
            $('breath-circle').classList.remove('active');
            
            // Reset breath circle styles
            const circle = $('breath-circle');
            circle.style.transform = '';
            circle.style.background = '';
            circle.style.boxShadow = '';
            
            // Reset recipient keuze
            $$('.recipient-chip').forEach(c => c.classList.remove('active'));
            $$('.recipient-chip')[0].classList.add('active');
            STATE.recipient = 'ik';
            STATE.customRecipient = '';
            $('recipient-custom').classList.remove('visible');
            $('recipient-input').value = '';
            $('recipient-name-display').classList.remove('visible');
            
            STATE.currentIntention = 0;
            STATE.startIntention = 0;
            STATE.remaining = STATE.duration;
            showIntention(0);
            updateDots();
            
            $('start-btn').innerHTML = `
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                Start
            `;

            document.querySelector('.meditation-view').style.display = 'flex';
            document.querySelector('.controls').style.display = 'flex';
            $('rating-view').classList.remove('active');
            $('success-view').classList.remove('active');
        }

        function updateBreathPhase() {
            if (!STATE.isMeditating) return;
            
            const { inhale, hold, exhale } = STATE.breath;
            const cycleTime = inhale + hold + exhale;
            
            const elapsed = Date.now() - STATE.breathStartTime;
            const cycleMs = (elapsed % (cycleTime * 1000));
            const phase = cycleMs / 1000; // seconds into current cycle
            
            const circle = $('breath-circle');
            let phaseText = 'Adem in';
            let scale, bgOpacity;
            
            if (phase < inhale) {
                // INADEMEN
                phaseText = 'Adem in';
                const progress = phase / inhale; // 0 to 1
                const baseScale = 0.7 + (progress * 0.3); // 0.7 to 1.0
                const pulse = Math.sin(phase * Math.PI * 2) * 0.02;
                scale = baseScale + pulse;
                bgOpacity = 0.04 + (progress * 0.12);
            } else if (hold > 0 && phase < inhale + hold) {
                // VASTHOUDEN (alleen als hold > 0)
                phaseText = 'Vasthouden';
                const holdPhase = phase - inhale;
                const pulse = Math.sin(holdPhase * Math.PI * 1) * 0.02;
                scale = 1.0 + pulse;
                bgOpacity = 0.16 + (pulse * 0.5);
            } else {
                // UITADEMEN
                phaseText = 'Adem uit';
                const exhaleStart = inhale + hold;
                const progress = (phase - exhaleStart) / exhale; // 0 to 1
                const baseScale = 1.0 - (progress * 0.3); // 1.0 to 0.7
                const pulse = Math.sin((phase - exhaleStart) * Math.PI * 1.5) * 0.015;
                scale = baseScale + pulse;
                bgOpacity = 0.16 - (progress * 0.12);
            }
            
            // Apply styles
            circle.style.transform = `scale(${scale})`;
            circle.style.background = `linear-gradient(145deg, rgba(201, 154, 0, ${bgOpacity}), rgba(166, 124, 0, ${bgOpacity * 0.6}))`;
            circle.style.boxShadow = `0 0 0 1px rgba(201, 154, 0, ${bgOpacity * 0.5}), 0 ${8 + scale * 10}px ${20 + scale * 20}px rgba(201, 154, 0, ${bgOpacity * 0.8})`;
            
            $('breath-phase-text').textContent = phaseText;
        }

        function updateProgressRing() {
            if (!STATE.isMeditating) return;
            
            const circumference = 653.45;
            const elapsed = STATE.duration - STATE.remaining;
            const progress = elapsed / STATE.duration;
            
            const offset = -circumference * progress;
            $('ring-progress').style.strokeDashoffset = offset;
            
            const opacity = 1 - (progress * 0.7);
            $('ring-progress').style.opacity = opacity;
        }

        function showIntention(index) {
            const intentions = getIntentions(STATE.recipient);
            const intentionEl = $('intention-text');
            intentionEl.innerHTML = intentions[index].text;
        }

        function transitionIntention(index) {
            const intentions = getIntentions(STATE.recipient);
            const intentionEl = $('intention-text');
            intentionEl.classList.remove('visible');
            
            setTimeout(() => {
                intentionEl.innerHTML = intentions[index].text;
                intentionEl.classList.add('visible');
                updateDots();
            }, 300);
        }

        function updateDots() {
            $$('.dot').forEach((dot, i) => {
                dot.classList.remove('active', 'done');
                if (i === STATE.currentIntention) {
                    dot.classList.add('active');
                } else if (i < STATE.currentIntention) {
                    dot.classList.add('done');
                }
            });
        }

        // Mood slider
        $('mood-slider').addEventListener('input', (e) => {
            STATE.selectedMood = parseInt(e.target.value);
            updateMoodDisplay();
        });

        function updateMoodDisplay() {
            const mood = MOODS[STATE.selectedMood - 1];
            $('mood-emoji').innerHTML = mood.icon;
            $('mood-label-main').textContent = mood.label;
            $('mood-label-sub').textContent = mood.desc;
        }

        // Save
        $('save-btn').addEventListener('click', () => {
            const entry = {
                date: new Date().toISOString(),
                mood: STATE.selectedMood,
                recipient: STATE.recipient,
                timestamp: Date.now()
            };

            STATE.entries.push(entry);
            localStorage.setItem('lk_entries', JSON.stringify(STATE.entries));

            $('rating-view').classList.remove('active');
            $('success-view').classList.add('active');
        });

        $('new-session-btn').addEventListener('click', () => {
            STATE.selectedMood = 3;
            $('mood-slider').value = 3;
            updateMoodDisplay();
            resetMeditation();
        });

        // Calendar
        $('prev-month').addEventListener('click', () => changeMonth(-1));
        $('next-month').addEventListener('click', () => changeMonth(1));

        function changeMonth(delta) {
            STATE.currentMonth += delta;
            if (STATE.currentMonth > 11) {
                STATE.currentMonth = 0;
                STATE.currentYear++;
            } else if (STATE.currentMonth < 0) {
                STATE.currentMonth = 11;
                STATE.currentYear--;
            }
            renderCalendar();
        }

        function renderCalendar() {
            const date = new Date(STATE.currentYear, STATE.currentMonth);
            const title = date.toLocaleDateString('nl-NL', { month: 'long', year: 'numeric' });
            $('calendar-title').textContent = title.charAt(0).toUpperCase() + title.slice(1);

            const container = $('calendar-days');
            container.innerHTML = '';

            const firstDay = new Date(STATE.currentYear, STATE.currentMonth, 1);
            const lastDay = new Date(STATE.currentYear, STATE.currentMonth + 1, 0);
            const startingDay = (firstDay.getDay() + 6) % 7;
            const today = new Date();

            const prevLast = new Date(STATE.currentYear, STATE.currentMonth, 0).getDate();
            for (let i = startingDay - 1; i >= 0; i--) {
                container.appendChild(createDay(prevLast - i, true));
            }

            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dateStr = formatDateKey(STATE.currentYear, STATE.currentMonth, i);
                const dayEntries = getEntriesForDate(dateStr);
                const isToday = today.getDate() === i && 
                    today.getMonth() === STATE.currentMonth && 
                    today.getFullYear() === STATE.currentYear;

                const day = createDay(i, false, isToday, dayEntries);
                if (dayEntries.length > 0) {
                    day.addEventListener('click', () => showDayModal(dateStr, dayEntries));
                }
                container.appendChild(day);
            }

            const remaining = 42 - container.children.length;
            for (let i = 1; i <= remaining; i++) {
                container.appendChild(createDay(i, true));
            }
        }

        function createDay(num, isOther, isToday = false, entries = []) {
            const day = document.createElement('div');
            day.className = 'day';
            if (isOther) day.classList.add('other');
            if (isToday) day.classList.add('today');
            
            if (entries.length > 0) {
                day.classList.add('has-entry');
                const avgMood = Math.round(entries.reduce((s, e) => s + e.mood, 0) / entries.length);
                day.classList.add(`mood-${avgMood}`);
            }

            let html = `<span>${num}</span>`;
            if (entries.length > 1) {
                html += `<span class="day-count">${entries.length}</span>`;
            }
            day.innerHTML = html;
            return day;
        }

        function getMoodSvg(mood) {
            const svgs = [
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="8" y1="14" x2="16" y2="14"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/></svg>',
                '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 13c0 2 1.8 3 4 3s4-1 4-3"/></svg>'
            ];
            return svgs[mood - 1] || svgs[2];
        }

        function formatDateKey(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function getEntriesForDate(dateStr) {
            return STATE.entries.filter(e => {
                const entryDate = new Date(e.date);
                const localDateStr = `${entryDate.getFullYear()}-${String(entryDate.getMonth() + 1).padStart(2, '0')}-${String(entryDate.getDate()).padStart(2, '0')}`;
                return localDateStr === dateStr;
            });
        }

        // Day Modal
        function showDayModal(dateStr, entries) {
            const date = new Date(dateStr + 'T00:00:00');
            $('modal-title').textContent = date.toLocaleDateString('nl-NL', { weekday: 'long' });
            $('modal-date').textContent = date.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long', year: 'numeric' });

            $('modal-entries').innerHTML = entries.map(e => {
                const time = new Date(e.date).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
                const recipientText = e.recipient === 'ik' ? 'Voor mezelf' : `Voor ${e.recipient}`;
                return `
                    <div class="modal-entry">
                        <div>
                            <span class="modal-entry-time">${time}</span>
                            <div class="modal-entry-recipient">${recipientText}</div>
                        </div>
                        <span class="modal-entry-mood">${getMoodSvg(e.mood)} ${MOODS[e.mood - 1].label}</span>
                    </div>
                `;
            }).join('');

            $('day-modal').classList.add('visible');
        }

        $('day-modal').addEventListener('click', e => {
            if (e.target === $('day-modal')) $('day-modal').classList.remove('visible');
        });
        $('modal-close').addEventListener('click', () => $('day-modal').classList.remove('visible'));
        $('day-modal-close').addEventListener('click', () => $('day-modal').classList.remove('visible'));

        // Clear data
        $('clear-data').addEventListener('click', () => {
            if (confirm('Weet je zeker dat je alle sessies wilt wissen? Dit kan niet ongedaan worden gemaakt.')) {
                STATE.entries = [];
                localStorage.removeItem('lk_entries');
                renderCalendar();
                updateStats();
            }
        });

        function updateStats() {
            $('stat-total').textContent = STATE.entries.length;
            $('stat-streak').textContent = calculateStreak();

            if (STATE.entries.length > 0) {
                const avg = STATE.entries.reduce((s, e) => s + e.mood, 0) / STATE.entries.length;
                $('stat-mood').innerHTML = getMoodSvg(Math.round(avg));
            } else {
                $('stat-mood').textContent = '';
            }
        }

        function calculateStreak() {
            if (STATE.entries.length === 0) return 0;

            // Helper to get local date string from entry
            function getLocalDateStr(entry) {
                const d = new Date(entry.date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let checkDate = new Date(today);
            let streak = 0;

            const todayStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`;
            const hasToday = STATE.entries.some(e => getLocalDateStr(e) === todayStr);

            if (!hasToday) {
                checkDate.setDate(checkDate.getDate() - 1);
                const yesterdayStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`;
                if (!STATE.entries.some(e => getLocalDateStr(e) === yesterdayStr)) return 0;
            }

            while (true) {
                const dateStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`;
                if (STATE.entries.some(e => getLocalDateStr(e) === dateStr)) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }

            return streak;
        }

        // Analytics Modal
        $('analytics-btn').addEventListener('click', () => showAnalytics('overview'));
        $('stat-sessions').addEventListener('click', () => showAnalytics('sessions'));
        $('stat-streak-card').addEventListener('click', () => showAnalytics('streaks'));
        $('stat-mood-card').addEventListener('click', () => showAnalytics('mood'));

        function showAnalytics(view) {
            STATE.analyticsView = view;
            renderAnalytics();
            $('analytics-modal').classList.add('visible');
        }

        function renderAnalytics() {
            const content = $('analytics-content');
            
            if (STATE.entries.length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><svg viewBox="0 0 24 24"><path d="M3 3v18h18v-2H5V3H3zm4 12h2v4H7v-4zm4-5h2v9h-2v-9zm4-3h2v12h-2V7zm4-4h2v16h-2V3z"/></svg></div>
                        <p>Nog geen data beschikbaar.<br>Start je eerste meditatie!</p>
                    </div>
                `;
                return;
            }

            switch (STATE.analyticsView) {
                case 'sessions':
                    content.innerHTML = renderSessionsList();
                    break;
                case 'streaks':
                    content.innerHTML = renderStreaksView();
                    break;
                case 'mood':
                    content.innerHTML = renderMoodAnalysis();
                    break;
                default:
                    content.innerHTML = renderOverview();
            }
        }

        function renderOverview() {
            const streaks = calculateAllStreaks();
            const longestStreak = streaks.length > 0 ? Math.max(...streaks.map(s => s.days)) : 0;
            const moodDist = getMoodDistribution();
            const avgMood = STATE.entries.reduce((s, e) => s + e.mood, 0) / STATE.entries.length;
            
            // Find best day
            const dayMoods = {};
            STATE.entries.forEach(e => {
                const day = new Date(e.date).toLocaleDateString('nl-NL', { weekday: 'long' });
                if (!dayMoods[day]) dayMoods[day] = [];
                dayMoods[day].push(e.mood);
            });
            
            let bestDay = '-';
            let bestDayAvg = 0;
            Object.entries(dayMoods).forEach(([day, moods]) => {
                const avg = moods.reduce((a, b) => a + b, 0) / moods.length;
                if (avg > bestDayAvg) {
                    bestDayAvg = avg;
                    bestDay = day.charAt(0).toUpperCase() + day.slice(1);
                }
            });

            return `
                <div class="analytics-highlight">
                    <div class="highlight-card">
                        <div class="highlight-value">${longestStreak}</div>
                        <div class="highlight-label">Langste streak</div>
                    </div>
                    <div class="highlight-card">
                        <div class="highlight-value">${bestDay}</div>
                        <div class="highlight-label">Beste dag</div>
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-section-title">Stemming verdeling</div>
                    <div class="mood-distribution">
                        ${[1, 2, 3, 4, 5].map(m => {
                            const count = moodDist[m] || 0;
                            const maxCount = Math.max(...Object.values(moodDist), 1);
                            const height = (count / maxCount) * 50;
                            const opacities = [0.35, 0.50, 0.65, 0.80, 1.0];
                            const opacity = opacities[m - 1];
                            return `
                                <div class="mood-bar-container">
                                    <div class="mood-bar" style="height: ${height}px; background: rgba(212, 160, 0, ${opacity});"></div>
                                    <div class="mood-bar-label">${count}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.65rem; color: var(--text-muted); margin-top: 4px; padding: 0 4px;">
                        <span>Zwaar</span>
                        <span>Stralend</span>
                    </div>
                </div>

                <div style="display: flex; gap: 16px; margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <button class="btn btn-secondary" style="flex: 1; min-width: auto; padding: 12px 16px; font-size: 0.85rem;" onclick="showAnalytics('sessions')">Alle sessies</button>
                    <button class="btn btn-secondary" style="flex: 1; min-width: auto; padding: 12px 16px; font-size: 0.85rem;" onclick="showAnalytics('streaks')">Streaks</button>
                </div>
            `;
        }

        function renderSessionsList() {
            // Helper to get local date string from entry
            function getLocalDateStr(entry) {
                const d = new Date(entry.date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            }

            // Group by local date
            const grouped = {};
            [...STATE.entries].reverse().forEach(e => {
                const dateKey = getLocalDateStr(e);
                if (!grouped[dateKey]) grouped[dateKey] = [];
                grouped[dateKey].push(e);
            });

            let html = `
                <button class="btn btn-secondary" style="margin-bottom: 16px; padding: 10px 16px; min-width: auto;" onclick="showAnalytics('overview')">
                     Terug naar overzicht
                </button>
                <div class="analytics-section">
                    <div class="analytics-section-title">Alle sessies (${STATE.entries.length})</div>
                    <div class="sessions-list">
            `;

            Object.entries(grouped).forEach(([dateKey, entries]) => {
                const date = new Date(dateKey + 'T00:00:00');
                const dateStr = date.toLocaleDateString('nl-NL', { weekday: 'short', day: 'numeric', month: 'short' });
                
                html += `<div class="session-date-group">`;
                html += `<div class="session-date-header">${dateStr}</div>`;
                
                entries.forEach(e => {
                    const time = new Date(e.date).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
                    const recipientText = e.recipient === 'ik' ? 'Mezelf' : e.recipient;
                    html += `
                        <div class="session-item">
                            <span class="session-time">${time}</span>
                            <div class="session-details">
                                <span class="session-recipient">${recipientText}</span>
                                <span class="session-mood">${getMoodSvg(e.mood)}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });

            html += `</div></div>`;
            return html;
        }

        function renderStreaksView() {
            const streaks = calculateAllStreaks();
            const currentStreak = calculateStreak();

            let html = `
                <button class="btn btn-secondary" style="margin-bottom: 16px; padding: 10px 16px; min-width: auto;" onclick="showAnalytics('overview')">
                     Terug naar overzicht
                </button>
                <div class="analytics-section">
                    <div class="analytics-section-title">Streak historie</div>
            `;

            if (streaks.length === 0) {
                html += `<div class="empty-state" style="padding: 20px;"><p>Nog geen streaks opgebouwd.</p></div>`;
            } else {
                html += `<div class="streak-list">`;
                streaks.forEach((streak, i) => {
                    const isCurrent = i === 0 && streak.days === currentStreak && currentStreak > 0;
                    html += `
                        <div class="streak-item ${isCurrent ? 'current' : ''}">
                            <span class="streak-dates">${streak.start} - ${streak.end}</span>
                            <span class="streak-days">${streak.days} ${streak.days === 1 ? 'dag' : 'dagen'}</span>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        function renderMoodAnalysis() {
            const moodDist = getMoodDistribution();
            const avgMood = STATE.entries.reduce((s, e) => s + e.mood, 0) / STATE.entries.length;
            const opacities = [0.35, 0.50, 0.65, 0.80, 1.0];
            
            // Weekly mood trend
            const lastWeek = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                const dayEntries = STATE.entries.filter(e => {
                    const entryDate = new Date(e.date);
                    const localDateStr = `${entryDate.getFullYear()}-${String(entryDate.getMonth() + 1).padStart(2, '0')}-${String(entryDate.getDate()).padStart(2, '0')}`;
                    return localDateStr === dateStr;
                });
                const avg = dayEntries.length > 0 
                    ? dayEntries.reduce((s, e) => s + e.mood, 0) / dayEntries.length 
                    : null;
                lastWeek.push({
                    day: d.toLocaleDateString('nl-NL', { weekday: 'short' }),
                    avg
                });
            }

            return `
                <button class="btn btn-secondary" style="margin-bottom: 16px; padding: 10px 16px; min-width: auto;" onclick="showAnalytics('overview')">
                     Terug naar overzicht
                </button>
                
                <div class="analytics-section">
                    <div class="analytics-section-title">Gemiddelde stemming</div>
                    <div class="highlight-card" style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                        <span style="font-size: 2rem;">${getMoodSvg(Math.round(avgMood))}</span>
                        <div>
                            <div class="highlight-value">${avgMood.toFixed(1)}</div>
                            <div class="highlight-label">${MOODS[Math.round(avgMood) - 1]?.label || '-'}</div>
                        </div>
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-section-title">Afgelopen 7 dagen</div>
                    <div style="display: flex; gap: 4px; align-items: flex-end; height: 80px; padding: 0 4px;">
                        ${lastWeek.map(d => {
                            if (d.avg === null) {
                                return `<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                    <div style="width: 100%; height: 4px; background: var(--border); border-radius: 2px;"></div>
                                    <span style="font-size: 0.6rem; color: var(--text-muted); margin-top: 6px;">${d.day}</span>
                                </div>`;
                            }
                            const height = (d.avg / 5) * 50;
                            const moodIndex = Math.round(d.avg) - 1;
                            const opacity = opacities[moodIndex] || 0.65;
                            return `<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; height: ${height}px; background: rgba(212, 160, 0, ${opacity}); border-radius: 4px 4px 0 0;"></div>
                                <span style="font-size: 0.6rem; color: var(--text-muted); margin-top: 6px;">${d.day}</span>
                            </div>`;
                        }).join('')}
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-section-title">Verdeling</div>
                    ${[5, 4, 3, 2, 1].map(m => {
                        const count = moodDist[m] || 0;
                        const pct = STATE.entries.length > 0 ? (count / STATE.entries.length * 100) : 0;
                        const opacity = opacities[m - 1];
                        return `
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="width: 70px; font-size: 0.75rem; color: var(--text-soft);">${MOODS[m-1].label}</span>
                                <div style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${pct}%; height: 100%; background: rgba(212, 160, 0, ${opacity}); border-radius: 4px;"></div>
                                </div>
                                <span style="width: 30px; font-size: 0.75rem; color: var(--text-muted); text-align: right;">${count}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function calculateAllStreaks() {
            if (STATE.entries.length === 0) return [];

            // Helper to get local date string from entry
            function getLocalDateStr(entry) {
                const d = new Date(entry.date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            }

            // Get unique local dates
            const dates = [...new Set(STATE.entries.map(e => getLocalDateStr(e)))].sort().reverse();
            
            const streaks = [];
            let currentStreak = null;

            for (let i = 0; i < dates.length; i++) {
                const currentDate = new Date(dates[i] + 'T00:00:00');
                
                if (!currentStreak) {
                    currentStreak = { start: dates[i], end: dates[i], days: 1 };
                } else {
                    const prevDate = new Date(currentStreak.end + 'T00:00:00');
                    const diff = (prevDate - currentDate) / (1000 * 60 * 60 * 24);
                    
                    if (diff === 1) {
                        currentStreak.end = dates[i];
                        currentStreak.days++;
                    } else {
                        streaks.push(formatStreak(currentStreak));
                        currentStreak = { start: dates[i], end: dates[i], days: 1 };
                    }
                }
            }
            
            if (currentStreak) {
                streaks.push(formatStreak(currentStreak));
            }

            return streaks.sort((a, b) => b.days - a.days);
        }

        function formatStreak(streak) {
            const formatDate = (d) => new Date(d + 'T00:00:00').toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
            return {
                start: formatDate(streak.start),
                end: formatDate(streak.end),
                days: streak.days
            };
        }

        function getMoodDistribution() {
            const dist = {};
            STATE.entries.forEach(e => {
                dist[e.mood] = (dist[e.mood] || 0) + 1;
            });
            return dist;
        }

        // Analytics modal close
        $('analytics-modal').addEventListener('click', e => {
            if (e.target === $('analytics-modal')) $('analytics-modal').classList.remove('visible');
        });
        $('analytics-close').addEventListener('click', () => $('analytics-modal').classList.remove('visible'));
        $('analytics-modal-close').addEventListener('click', () => $('analytics-modal').classList.remove('visible'));

        // Make showAnalytics global for inline onclick
        window.showAnalytics = showAnalytics;

        // Swipe on intention text
        const intentionDisplay = document.querySelector('.intention-display');
        let touchStartX = 0;
        let touchEndX = 0;
        let isSwiping = false;

        intentionDisplay.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            isSwiping = true;
        }, { passive: true });

        intentionDisplay.addEventListener('touchmove', (e) => {
            if (!isSwiping) return;
            touchEndX = e.changedTouches[0].screenX;
        }, { passive: true });

        intentionDisplay.addEventListener('touchend', (e) => {
            if (!isSwiping) return;
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
            isSwiping = false;
        });

        // Mouse support for desktop
        intentionDisplay.addEventListener('mousedown', (e) => {
            touchStartX = e.screenX;
            isSwiping = true;
        });

        document.addEventListener('mousemove', (e) => {
            if (!isSwiping) return;
            touchEndX = e.screenX;
        });

        document.addEventListener('mouseup', (e) => {
            if (!isSwiping) return;
            touchEndX = e.screenX;
            handleSwipe();
            isSwiping = false;
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) < swipeThreshold) return;
            
            const intentions = getIntentions(STATE.recipient);
            let newIndex = STATE.currentIntention;
            
            if (diff > 0) {
                // Swipe left = next
                newIndex = (STATE.currentIntention + 1) % intentions.length;
            } else {
                // Swipe right = previous
                newIndex = (STATE.currentIntention - 1 + intentions.length) % intentions.length;
            }
            
            if (newIndex !== STATE.currentIntention) {
                STATE.currentIntention = newIndex;
                
                // Als meditatie bezig is, update startIntention zodat timing klopt
                if (STATE.isMeditating || STATE.isPaused) {
                    const elapsed = STATE.duration - STATE.remaining;
                    const intentionOffset = Math.floor(elapsed / 30);
                    // Bereken welke startIntention nodig is zodat huidige berekening newIndex geeft
                    STATE.startIntention = (newIndex - intentionOffset % 4 + 4) % 4;
                }
                
                transitionIntention(newIndex);
            }
        }

        // Click on dots to jump to intention
        $$('.dot').forEach((dot, index) => {
            dot.addEventListener('click', () => {
                if (index !== STATE.currentIntention) {
                    // Als meditatie bezig is, update startIntention zodat timing klopt
                    if (STATE.isMeditating || STATE.isPaused) {
                        const elapsed = STATE.duration - STATE.remaining;
                        const intentionOffset = Math.floor(elapsed / 30);
                        STATE.startIntention = (index - intentionOffset % 4 + 4) % 4;
                    }
                    
                    STATE.currentIntention = index;
                    transitionIntention(index);
                }
            });
        });

        // Settings Modal
        $('open-settings').addEventListener('click', (e) => {
            e.preventDefault();
            $('info-tooltip').classList.remove('visible');
            openSettings();
        });

        function openSettings() {
            // Load current values into inputs
            $('setting-inhale').value = STATE.breath.inhale;
            $('setting-hold').value = STATE.breath.hold;
            $('setting-exhale').value = STATE.breath.exhale;
            updateBreathPreview();
            $('settings-modal').classList.add('visible');
        }

        function updateBreathPreview() {
            const inhale = parseInt($('setting-inhale').value) || 4;
            const hold = parseInt($('setting-hold').value) || 0;
            const exhale = parseInt($('setting-exhale').value) || 6;
            const total = inhale + hold + exhale;
            
            // Update preview bars (max width ~80px)
            const maxVal = Math.max(inhale, hold || 1, exhale);
            const scale = 80 / maxVal;
            
            $('preview-inhale').style.width = `${inhale * scale}px`;
            $('preview-hold').style.width = hold > 0 ? `${hold * scale}px` : '4px';
            $('preview-hold').style.opacity = hold > 0 ? '0.7' : '0.2';
            $('preview-exhale').style.width = `${exhale * scale}px`;
            
            // Update total
            $('breath-cycle-total').textContent = total;
        }

        // Listen for input changes
        $('setting-inhale').addEventListener('input', updateBreathPreview);
        $('setting-hold').addEventListener('input', updateBreathPreview);
        $('setting-exhale').addEventListener('input', updateBreathPreview);

        // Reset to defaults
        $('settings-reset').addEventListener('click', () => {
            $('setting-inhale').value = DEFAULT_BREATH.inhale;
            $('setting-hold').value = DEFAULT_BREATH.hold;
            $('setting-exhale').value = DEFAULT_BREATH.exhale;
            updateBreathPreview();
        });

        // Save settings
        $('settings-save').addEventListener('click', () => {
            const inhale = Math.max(2, Math.min(10, parseInt($('setting-inhale').value) || 4));
            const hold = Math.max(0, Math.min(10, parseInt($('setting-hold').value) || 6));
            const exhale = Math.max(2, Math.min(12, parseInt($('setting-exhale').value) || 6));
            
            STATE.breath = { inhale, hold, exhale };
            localStorage.setItem('lk_breath', JSON.stringify(STATE.breath));
            
            $('settings-modal').classList.remove('visible');
        });

        // Close settings modal
        $('settings-modal').addEventListener('click', (e) => {
            if (e.target === $('settings-modal')) $('settings-modal').classList.remove('visible');
        });
        $('settings-modal-close').addEventListener('click', () => $('settings-modal').classList.remove('visible'));

        // Init
        renderCalendar();
        updateStats();

        // Privacy modal - show on first visit
        function checkPrivacyConsent() {
            const hasConsent = localStorage.getItem('lk_privacy_accepted');
            if (!hasConsent) {
                $('privacy-modal').classList.add('visible');
            }
        }

        $('privacy-accept').addEventListener('click', () => {
            localStorage.setItem('lk_privacy_accepted', 'true');
            $('privacy-modal').classList.remove('visible');
        });

        // Check on load
        checkPrivacyConsent();
    </script>
</body>
</html>
